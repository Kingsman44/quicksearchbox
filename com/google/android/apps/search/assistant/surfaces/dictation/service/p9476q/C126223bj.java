package com.google.android.apps.search.assistant.surfaces.dictation.service.p9476q;

import com.evernote.android.state.BuildConfig;
import com.google.android.apps.gsa.binaries.satin.app.C74268ry;
import com.google.android.apps.gsa.binaries.satin.app.C74269rz;
import com.google.android.apps.gsa.binaries.satin.app.C74278sj;
import com.google.android.apps.gsa.binaries.satin.app.aoj;
import com.google.android.apps.gsa.binaries.satin.app.aps;
import com.google.android.apps.gsa.nga.api.a.af;
import com.google.android.apps.gsa.nga.api.a.bj;
import com.google.android.apps.gsa.unifiedime.C118590h;
import com.google.android.apps.gsa.unifiedime.C118606x;
import com.google.android.apps.search.assistant.surfaces.dictation.p9427a.C125065at;
import com.google.android.apps.search.assistant.surfaces.dictation.service.directactions.C125350e;
import com.google.android.apps.search.assistant.surfaces.dictation.service.directactions.C125363r;
import com.google.android.apps.search.assistant.surfaces.dictation.service.directactions.C125364s;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125470af;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125471ag;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125503i;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125504j;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125510p;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125513s;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125517w;
import com.google.android.apps.search.assistant.surfaces.dictation.service.formatter.C125519y;
import com.google.android.apps.search.assistant.surfaces.dictation.service.fulfillment.C125703b;
import com.google.android.apps.search.assistant.surfaces.dictation.service.fulfillment.C125708c;
import com.google.android.apps.search.assistant.surfaces.dictation.service.fulfillment.C125749n;
import com.google.android.apps.search.assistant.surfaces.dictation.service.fulfillment.C125750o;
import com.google.android.apps.search.assistant.surfaces.dictation.service.fulfillment.C125751p;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9434e.C125422z;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9436f.C125431a;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9436f.C125461b;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9436f.C125462c;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9436f.C125463d;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9460m.C125930s;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9460m.C125931t;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9460m.C125933v;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9460m.C125934w;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9461n.C126057bv;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9474p.C126180i;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9474p.C126181j;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9479s.C126324be;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9479s.C126325bf;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9479s.C126333j;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9479s.C126345v;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9479s.p9480a.C126290c;
import com.google.android.apps.search.assistant.surfaces.dictation.service.p9483u.C126359b;
import com.google.apps.tiktok.experiments.C46897i;
import com.google.apps.tiktok.tracing.C47558bi;
import com.google.apps.tiktok.tracing.C47810es;
import com.google.apps.tiktok.tracing.C47831fm;
import com.google.apps.tiktok.tracing.contrib.p3700b.C47633f;
import com.google.apps.tiktok.tracing.contrib.p3700b.C47638k;
import com.google.assistant.p3897e.p3921j.C51809dy;
import com.google.common.base.C58838bb;
import com.google.common.p4522b.C58485gu;
import com.google.common.p4526f.C59052c;
import com.google.common.p4526f.C59071e;
import com.google.common.util.concurrent.C60856cj;
import com.google.common.util.concurrent.C60866ct;
import com.google.common.util.concurrent.C60870cx;
import com.google.common.util.concurrent.C60922j;
import com.google.protobuf.C62910ar;
import dagger.p5294a.C68225k;
import java.util.List;
import java.util.Locale;
import java.util.concurrent.Executor;
import java.util.concurrent.atomic.AtomicReference;
import kotlinx.coroutines.C71422aw;
import kotlinx.coroutines.C71424ay;
import kotlinx.coroutines.C71803m;
import p3186j$.util.Objects;
import p3186j$.util.Optional;
import p5462h.p5466c.C69577g;
import p5462h.p5466c.C69585o;
import p5462h.p5473f.p5475b.C69664n;
import p5488io.grpc.p5533i.C70862aj;
import p5535j.p5536a.p5545c.p5548c.p5549a.C71003bc;

/* renamed from: com.google.android.apps.search.assistant.surfaces.dictation.service.q.bj */
/* compiled from: PG */
public final class C126223bj {

    /* renamed from: a */
    public static final C59071e f347801a = C59071e.m91332i("com.google.android.apps.search.assistant.surfaces.dictation.service.q.bj");

    /* renamed from: b */
    public final C70862aj f347802b;

    /* renamed from: c */
    public final C126258cr f347803c;

    /* renamed from: d */
    public final bj f347804d;

    /* renamed from: e */
    public final C126057bv f347805e;

    /* renamed from: f */
    public final C126181j f347806f;

    /* renamed from: g */
    public final Locale f347807g;

    /* renamed from: h */
    public final C126259cs f347808h;

    /* renamed from: i */
    public final C125350e f347809i;

    /* renamed from: j */
    public final C126180i f347810j;

    /* renamed from: k */
    public final Executor f347811k;

    /* renamed from: l */
    public final C125750o f347812l;

    /* renamed from: m */
    public final AtomicReference f347813m;

    /* renamed from: n */
    public final AtomicReference f347814n = new AtomicReference(C126220bg.IDLE);

    /* renamed from: o */
    public C125470af f347815o;

    /* renamed from: p */
    public boolean f347816p = false;

    /* renamed from: q */
    public C126324be f347817q;

    /* renamed from: r */
    public final C126204ar f347818r;

    /* renamed from: s */
    public final C125422z f347819s;

    /* renamed from: t */
    public final C74278sj f347820t;

    /* renamed from: u */
    private final C125462c f347821u;

    /* renamed from: v */
    private final C125931t f347822v;

    /* renamed from: w */
    private final C60870cx f347823w;

    /* renamed from: x */
    private C60870cx f347824x;

    public C126223bj(C126204ar arVar, C70862aj ajVar, C126258cr crVar, bj bjVar, C126181j jVar, C125422z zVar, Locale locale, C126057bv bvVar, aoj aoj, C126259cs csVar, C74278sj sjVar, aps aps, C125749n nVar, C125462c cVar, C74268ry ryVar, Optional optional, boolean z, Executor executor) {
        C60870cx cxVar;
        bj bjVar2 = bjVar;
        C126181j jVar2 = jVar;
        Locale locale2 = locale;
        aps aps2 = aps;
        this.f347818r = arVar;
        this.f347802b = ajVar;
        this.f347803c = crVar;
        this.f347804d = bjVar2;
        this.f347819s = zVar;
        this.f347806f = jVar2;
        this.f347807g = locale2;
        this.f347805e = bvVar;
        this.f347808h = csVar;
        this.f347820t = sjVar;
        C62910ar arVar2 = (C62910ar) ((C46897i) aps2.f199140a.a.d.f201488a.a.f202914g.mo17428b()).mo50901a("com.google.android.apps.search.assistant.device 45353653").mo50905d();
        C68225k.m98532d(arVar2);
        C125364s sVar = new C125364s(arVar2, (C71422aw) aps2.f199140a.a.H.mo17428b(), aps2.f199140a.b.f198027a.mo66667Z());
        this.f347809i = sVar;
        this.f347821u = cVar;
        this.f347810j = new C126180i(jVar2, (C74269rz) ryVar.f207982a.c.s.mo17428b());
        this.f347811k = executor;
        this.f347817q = new C126333j(C125065at.f345040b, C125065at.f345040b, C125513s.f346103a, Optional.empty(), Optional.empty(), bjVar2.c > 0);
        this.f347813m = new AtomicReference(new C126325bf(C58485gu.m89845m()));
        this.f347812l = nVar.mo107100a(locale2, bjVar2, jVar2);
        if (!z || optional.isEmpty()) {
            cxVar = C60856cj.m92900i(Optional.empty());
        } else {
            cxVar = ((C126359b) optional.get()).mo107567a();
        }
        this.f347823w = cxVar;
        af afVar = bjVar2.a;
        afVar = afVar == null ? af.w : afVar;
        C125934w wVar = C125934w.f347146a;
        this.f347822v = aoj.mo66633a(C125933v.m205976b(afVar));
        C125364s sVar2 = sVar;
        C71803m.m105043d(sVar.f345763a, (C69585o) null, (C71424ay) null, new C125363r(sVar, (C69577g) null), 3);
        mo107470g();
    }

    /* renamed from: b */
    public static C58485gu m206415b(C125065at atVar) {
        if (atVar.f345042a.size() != 1) {
            ((C59052c) ((C59052c) f347801a.mo56226d()).mo56372aa(36941)).mo56389s("#getResultAlternatives: there should be exactly one span in dictated text, but got %s [SD]", C126290c.m206496a(Integer.valueOf(atVar.f345042a.size())));
            return C58485gu.m89845m();
        } else if ((((C118606x) atVar.f345042a.get(0)).f330894a & 8) == 0) {
            return C58485gu.m89845m();
        } else {
            C118590h hVar = ((C118606x) atVar.f345042a.get(0)).f330899f;
            if (hVar == null) {
                hVar = C118590h.f330865d;
            }
            return C58485gu.m89842j(hVar.f330868b);
        }
    }

    /* renamed from: i */
    private final C60870cx m206416i() {
        C60870cx cxVar = this.f347824x;
        if (cxVar != null) {
            return cxVar;
        }
        C60870cx a = this.f347809i.mo106933a();
        this.f347824x = a;
        this.f347805e.mo107282f(a);
        return a;
    }

    /* renamed from: a */
    public final C125708c mo107465a() {
        Locale locale = this.f347807g;
        C60870cx i = m206416i();
        bj bjVar = this.f347804d;
        C126324be beVar = this.f347817q;
        C125930s c = this.f347822v.mo107184c();
        C58485gu guVar = ((C126325bf) this.f347813m.get()).f347993a;
        C125931t tVar = this.f347822v;
        return new C125708c(locale, i, bjVar, beVar, c, guVar, tVar.mo107189h() && C69664n.m101066l(tVar.mo107187f(), "com.google.android.gm"));
    }

    /* renamed from: c */
    public final C60870cx mo107466c(String str, C125751p pVar) {
        C47558bi a = C47831fm.m85006a("SD.OrationEvent.Final.Command");
        try {
            List list = pVar.f346564b;
            C125703b bVar = pVar.f346565c;
            C126324be beVar = this.f347817q;
            if (!((C126333j) beVar).f348021f) {
                C125065at a2 = C126345v.m206599a(((C126333j) beVar).f348017b);
                C125065at atVar = C125065at.f345040b;
                C126324be beVar2 = this.f347817q;
                C125510p e = C125510p.m205497e(a2, atVar, ((C126333j) beVar2).f348018c.mo107029d(C126345v.m206601c(((C126333j) beVar2).f348017b), BuildConfig.FLAVOR, C125471ag.f346016a), C71003bc.f189358g);
                this.f347803c.mo107491a(((C125504j) e).f346083a, ((C125504j) e).f346084b, str.trim(), this.f347817q);
                mo107471h(C126324be.m206557g(e));
            }
            C60870cx f = mo107469f(pVar);
            a.mo51417a(f);
            a.close();
            return f;
        } catch (Throwable th) {
            C126209aw.m206411a(th, th);
        }
        throw th;
    }

    /* renamed from: d */
    public final C60870cx mo107467d(String str, C58485gu guVar) {
        C47558bi a;
        C47558bi a2 = C47831fm.m85006a("SD.OrationEvent.Final.Dictate");
        try {
            C125470af afVar = this.f347815o;
            if (afVar != null) {
                C125513s sVar = ((C126333j) this.f347817q).f348018c;
                C60870cx cxVar = this.f347823w;
                a = C47831fm.m85006a("SD.Formatter.Commit");
                C125503i b = sVar.mo107017a().mo106982a().mo106992b(C125503i.m205472c(str, afVar.f346006d, guVar));
                C60870cx e = afVar.mo106981e(1, C125470af.m205446d(sVar.mo107017a(), C125470af.f346005c.mo56195p(str)), BuildConfig.FLAVOR, sVar, afVar.f346012j);
                C60870cx a3 = C47638k.m84753d(e, cxVar).mo51520a(new C125519y(afVar, e, sVar, b, cxVar), afVar.f346011i);
                a.mo51417a(a3);
                a.close();
                C126217bd bdVar = new C126217bd(this);
                C60870cx g = C60922j.m93044g(a3, C47810es.m84963c(bdVar), this.f347811k);
                a2.mo51417a(g);
                a2.close();
                return g;
            }
            throw new IllegalStateException("Missing formatter");
        } catch (Throwable th) {
            try {
                a2.close();
            } catch (Throwable th2) {
                C126209aw.m206411a(th, th2);
            }
            throw th;
        }
        throw th;
    }

    /* renamed from: e */
    public final C60870cx mo107468e(String str, C58485gu guVar) {
        C60870cx cxVar;
        C47558bi a;
        C47558bi a2 = C47831fm.m85006a("SD.OrationEvent.Partial.Dictate");
        try {
            C125470af afVar = this.f347815o;
            if (afVar == null) {
                ((C59052c) ((C59052c) f347801a.mo56226d()).mo56372aa(36944)).mo56386p("Missing formatter for partial [SD]");
                cxVar = C60866ct.f164955a;
            } else {
                C125513s sVar = ((C126333j) this.f347817q).f348018c;
                a = C47831fm.m85006a("SD.Formatter.Preview");
                String p = C125470af.f346005c.mo56195p(str);
                C125503i b = sVar.mo107017a().mo106982a().mo106992b(C125503i.m205472c(str, afVar.f346006d, guVar));
                C60870cx e = afVar.mo106981e(2, C125470af.m205446d(sVar.mo107017a(), BuildConfig.FLAVOR), p, sVar, afVar.f346012j);
                C125517w wVar = new C125517w(afVar, p, sVar, b);
                C60870cx g = C60922j.m93044g(e, C47810es.m84963c(wVar), afVar.f346011i);
                a.mo51417a(g);
                a.close();
                C126214ba baVar = new C126214ba(this);
                cxVar = C60922j.m93044g(g, C47810es.m84963c(baVar), this.f347811k);
            }
            a2.mo51417a(cxVar);
            a2.close();
            return cxVar;
        } catch (Throwable th) {
            try {
                a2.close();
            } catch (Throwable th2) {
                C126209aw.m206411a(th, th2);
            }
            throw th;
        }
        throw th;
    }

    /* renamed from: f */
    public final C60870cx mo107469f(C125751p pVar) {
        C125462c cVar = this.f347821u;
        List<C51809dy> list = pVar.f346564b;
        C125463d dVar = new C125463d(this.f347807g, this.f347802b, this.f347819s, this.f347822v, this.f347805e, new C126221bh(this), this.f347817q, m206416i(), this.f347806f, pVar.f346563a);
        C47558bi a = C47831fm.m85006a("SD.Execution");
        try {
            C58838bb.m90869d(!list.isEmpty(), "clientOps cannot be an empty list");
            C47633f g = C47633f.m84733g(C60856cj.m92900i(true));
            for (C51809dy dyVar : list) {
                g = g.mo51516i(new C125431a(cVar, dyVar, dVar), cVar.f345985b).mo51515h(new C125461b(dyVar), cVar.f345985b);
            }
            a.mo51417a(g);
            a.close();
            return C47633f.m84733g(g).mo51516i(new C126218be(this, pVar), this.f347811k);
        } catch (Throwable th) {
            try {
                Throwable.class.getDeclaredMethod("addSuppressed", new Class[]{Throwable.class}).invoke(th, new Object[]{th});
            } catch (Exception unused) {
            }
        }
        throw th;
    }

    /* renamed from: g */
    public final void mo107470g() {
        this.f347824x = null;
        this.f347815o = null;
        this.f347805e.mo107282f(this.f347809i.mo106933a());
    }

    /* renamed from: h */
    public final void mo107471h(C126324be beVar) {
        if (!beVar.equals(this.f347817q)) {
            Objects.requireNonNull(this.f347817q);
            Objects.requireNonNull(beVar);
            this.f347817q = beVar;
        }
    }
}
