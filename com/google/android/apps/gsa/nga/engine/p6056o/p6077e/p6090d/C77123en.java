package com.google.android.apps.gsa.nga.engine.p6056o.p6077e.p6090d;

import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.os.UserManager;
import com.google.android.apps.gsa.nga.engine.ag.af;
import com.google.android.apps.gsa.nga.engine.am.d.g;
import com.google.android.apps.gsa.nga.engine.am.h.bf;
import com.google.android.apps.gsa.nga.engine.am.h.df;
import com.google.android.apps.gsa.nga.engine.am.l.c.r;
import com.google.android.apps.gsa.nga.engine.am.q.f;
import com.google.android.apps.gsa.nga.engine.am.t;
import com.google.android.apps.gsa.nga.engine.am.t.a;
import com.google.android.apps.gsa.nga.engine.am.t.n;
import com.google.android.apps.gsa.nga.engine.am.v;
import com.google.android.apps.gsa.nga.engine.p5900ag.C74817bb;
import com.google.android.apps.gsa.nga.engine.p5907aj.C74849ah;
import com.google.android.apps.gsa.nga.engine.p5907aj.C74851z;
import com.google.android.apps.gsa.nga.engine.p5913am.p5938t.C74956m;
import com.google.android.apps.gsa.nga.engine.p5913am.p5939u.C74965n;
import com.google.android.apps.gsa.nga.engine.p5972aw.C75170o;
import com.google.android.apps.gsa.nga.engine.p6029g.C76087c;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76541a;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76564ah;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76574ar;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76590bg;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76591c;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76593e;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76594f;
import com.google.android.apps.gsa.nga.engine.p6056o.p6059c.C76599k;
import com.google.android.apps.gsa.nga.engine.p6144ui.answer.C78059be;
import com.google.android.apps.gsa.nga.engine.understanding.C79330v;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.C80399l;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.C80401n;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.p6282a.C80293ao;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.p6282a.C80295aq;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.p6282a.C80303ay;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.p6282a.C80307bb;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.p6282a.C80338cf;
import com.google.android.apps.gsa.nga.shared.p6307af.C80595f;
import com.google.android.apps.gsa.nga.shared.p6307af.C80600k;
import com.google.android.apps.gsa.nga.shared.p6307af.p6308a.C80590x;
import com.google.android.apps.gsa.nga.shared.p6358n.C81442m;
import com.google.android.apps.gsa.nga.shared.p6368u.C81515c;
import com.google.android.apps.gsa.nga.shared.p6407v.C83044e;
import com.google.android.apps.gsa.nga.shared.p6407v.C83216f;
import com.google.android.apps.gsa.nga.shared.p6407v.C83251g;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82831ca;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82835ce;
import com.google.android.apps.gsa.shared.p7066m.C90126fx;
import com.google.android.apps.gsa.shared.util.p7188v.C91142g;
import com.google.android.googlequicksearchbox.R;
import com.google.android.libraries.gsa.p1876k.C22871g;
import com.google.assistant.p3897e.p3921j.C51809dy;
import com.google.assistant.p3897e.p3921j.C52308my;
import com.google.assistant.p3897e.p3921j.C52321nk;
import com.google.assistant.p3897e.p3921j.C52373pi;
import com.google.assistant.p3897e.p3921j.C52374pj;
import com.google.common.p4522b.C58485gu;
import com.google.common.p4522b.C58528ij;
import com.google.common.p4522b.C58759qy;
import com.google.common.p4526f.p4527a.C58970a;
import com.google.common.p4526f.p4527a.C58974d;
import com.google.common.p4580v.C60950i;
import com.google.common.util.concurrent.C60856cj;
import com.google.common.util.concurrent.C60870cx;
import com.google.protos.p4883as.p4884a.C63775d;
import java.util.Locale;
import p3186j$.util.Objects;
import p3186j$.util.Optional;

/* renamed from: com.google.android.apps.gsa.nga.engine.o.e.d.en */
/* compiled from: PG */
public final class C77123en implements C76591c {

    /* renamed from: a */
    public static final C58974d f212843a = C58974d.m91136j();

    /* renamed from: b */
    public static final C58485gu f212844b = C58485gu.m89847o("com.google.android.googlequicksearchbox", "com.google.android.apps.messaging");

    /* renamed from: c */
    public static final C58528ij f212845c = new C58759qy("com.google.android.apps.nexuslauncher");

    /* renamed from: d */
    public static final String[] f212846d = {"android.permission.ACCESS_FINE_LOCATION", "android.permission.ACCESS_COARSE_LOCATION"};

    /* renamed from: s */
    private static final Uri f212847s = Uri.parse("https://play.google.com/store/apps/details?id=com.google.android.apps.photos");

    /* renamed from: e */
    public final C77089dg f212848e;

    /* renamed from: f */
    public final C74849ah f212849f;

    /* renamed from: g */
    public final C78059be f212850g;

    /* renamed from: h */
    public final r f212851h;

    /* renamed from: i */
    public final C22871g f212852i;

    /* renamed from: j */
    public final C22871g f212853j;

    /* renamed from: k */
    public final C91142g f212854k;

    /* renamed from: l */
    public final C75170o f212855l;

    /* renamed from: m */
    public final C74817bb f212856m;

    /* renamed from: n */
    public final C60950i f212857n;

    /* renamed from: o */
    public final C83216f f212858o;

    /* renamed from: p */
    public final C81515c f212859p;

    /* renamed from: q */
    public final f f212860q;

    /* renamed from: r */
    public final g f212861r;

    /* renamed from: t */
    private final Context f212862t;

    /* renamed from: u */
    private final C76087c f212863u;

    /* renamed from: v */
    private final n f212864v;

    /* renamed from: w */
    private final af f212865w;

    /* renamed from: x */
    private final UserManager f212866x;

    /* renamed from: y */
    private final bf f212867y;

    public C77123en(Context context, C77089dg dgVar, C74849ah ahVar, C78059be beVar, r rVar, C22871g gVar, C22871g gVar2, C91142g gVar3, C76087c cVar, n nVar, C75170o oVar, C74817bb bbVar, af afVar, C60950i iVar, C83251g gVar4, C81515c cVar2, f fVar, g gVar5, bf bfVar) {
        this.f212862t = context;
        this.f212848e = dgVar;
        this.f212849f = ahVar;
        this.f212850g = beVar;
        this.f212851h = rVar;
        this.f212852i = gVar;
        this.f212853j = gVar2;
        this.f212854k = gVar3;
        this.f212863u = cVar;
        this.f212864v = nVar;
        this.f212855l = oVar;
        this.f212856m = bbVar;
        this.f212865w = afVar;
        this.f212857n = iVar;
        this.f212858o = gVar4.mo76652a(C82831ca.SHARE);
        this.f212859p = cVar2;
        this.f212866x = (UserManager) context.getSystemService(UserManager.class);
        this.f212860q = fVar;
        this.f212861r = gVar5;
        this.f212867y = bfVar;
    }

    /* renamed from: f */
    public static C60870cx m123789f() {
        return C60856cj.m92900i(Optional.m71637of(C80401n.f220656k));
    }

    /* renamed from: j */
    public static boolean m123790j(String str) {
        if (str != null) {
            return str.startsWith("image/") || str.startsWith("video/");
        }
        return false;
    }

    /* renamed from: a */
    public final C76594f mo71711a() {
        C76593e h = C76594f.m123238h();
        h.mo72277g("Share_digital_object", C90126fx.f251263fX);
        ((C76541a) h).f211766c = 13011;
        h.mo72246e(Optional.m71637of(C82831ca.SHARE));
        h.mo72244c(C58485gu.m89846n("Share_digital_object"));
        return h.mo72276f();
    }

    /* renamed from: b */
    public final C60870cx mo71712b(C76590bg bgVar, C74965n nVar) {
        C77122em emVar;
        Optional optional;
        String str;
        Optional optional2;
        UserManager userManager;
        String str2 = (String) bgVar.mo72265g(C76564ah.f211801a, "object").orElse((String) bgVar.mo72265g(C76599k.f211846a, "object").orElse(null));
        C77122em emVar2 = C77122em.SCREENSHOT;
        if (str2 == null) {
            emVar = C77122em.OTHER;
        } else {
            String upperCase = str2.trim().toUpperCase(Locale.US);
            if (C79330v.m127278c(str2, "Person_location")) {
                emVar = C77122em.LOCATION;
            } else {
                emVar = (C77122em) v.a(C77122em.class, upperCase).orElse(C77122em.OTHER);
            }
        }
        C77122em emVar3 = emVar;
        if (emVar3 != C77122em.SCREENSHOT || (userManager = this.f212866x) == null || !userManager.getUserRestrictions().getBoolean("no_content_capture")) {
            if (emVar3.equals(C77122em.OTHER) && this.f212854k.mo85405j(C90126fx.f251679nP) && this.f212854k.mo85405j(C90126fx.f251040bM) && !this.f212849f.mo71237b().isPresent() && ((Boolean) nVar.mo71340o().map(C77101ds.f212785a).orElse(false)).booleanValue()) {
                try {
                    optional2 = Optional.m71637of(this.f212862t.getPackageManager().getPackageInfo("com.google.android.apps.photos", 0).versionName);
                } catch (Exception e) {
                    ((C58970a) ((C58970a) ((C58970a) f212843a.mo56226d()).mo56382g(e)).mo56372aa(3828)).mo56389s("Error while fetching version name of package %s", "com.google.android.apps.photos");
                    optional2 = Optional.empty();
                }
                if (optional2.isPresent() && C77001a.m123678a((String) optional2.get(), "4.21") < 0) {
                    Locale q = nVar.mo71342q();
                    C80399l lVar = (C80399l) C80401n.f220656k.createBuilder();
                    C81442m.m129557s(lVar, t.r(this.f212859p.mo75121a(q).getString(R.string.nga_share_photo_not_supported_on_old_google_photos, new Object[0])));
                    Intent intent = new Intent("android.intent.action.VIEW");
                    intent.setData(f212847s);
                    C80595f f = C80595f.m128216f(C80590x.CLIENT_OP_SUGGESTION_ON_DEVICE, this.f212859p.mo75121a(q).getString(R.string.nga_share_photo_not_supported_on_old_google_photos_suggestion, new Object[0]));
                    f.mo74361h(27105);
                    C81442m.m129557s(lVar, t.n(C80600k.m128226a(f.mo74357a(intent).mo74356a())));
                    return C60856cj.m92900i((C80401n) lVar.build());
                }
            }
            C58485gu a = bgVar.mo72259a("provider");
            Optional g = bgVar.mo72265g(C76574ar.f211813a, "provider");
            if (C77003ab.m123683c(a, g)) {
                if (a.isEmpty()) {
                    optional = g.flatMap(C77116eg.f212824a);
                } else {
                    optional = Optional.m71637of(((C63775d) a.get(0)).f172523d);
                }
                Locale q2 = nVar.mo71342q();
                C80399l lVar2 = (C80399l) C80401n.f220656k.createBuilder();
                Optional filter = optional.filter(C77119ej.f212832a);
                af afVar = this.f212865w;
                Objects.requireNonNull(afVar);
                Optional flatMap = filter.flatMap(new C77120ek(afVar));
                if (flatMap.isPresent()) {
                    C81515c cVar = this.f212859p;
                    str = cVar.mo75121a(q2).getString(R.string.nga_comms_share_in_unsupported_app, new Object[]{flatMap.get()});
                } else {
                    str = this.f212859p.mo75121a(q2).getString(R.string.nga_comms_share_in_unsupported_app_generic, new Object[0]);
                }
                C81442m.m129557s(lVar2, t.r(str));
                lVar2.mo74319k(60736);
                return C60856cj.m92900i((C80401n) lVar2.build());
            }
            C58485gu a2 = C77003ab.m123681a(bgVar, "audience");
            if (a2.isEmpty()) {
                this.f212858o.mo76648a(nVar.mo71336k(), C82835ce.NO_CONTACT, C83044e.f226656a);
                return C81442m.f222851a;
            } else if (a2.size() > 1) {
                getClass().getSimpleName();
                this.f212858o.mo76648a(nVar.mo71336k(), C82835ce.MULTIPLE_RECIPIENTS, C83044e.f226656a);
                return C81442m.f222851a;
            } else {
                C77087de k = C77088df.m123740k();
                k.mo72403e(true);
                C77129j jVar = (C77129j) k;
                jVar.f212874b = Optional.m71637of(this.f212858o);
                k.mo72404f(nVar);
                jVar.f212873a = Optional.m71637of((df) a2.get(0));
                k.mo72402d(a);
                k.mo72401c(g);
                C77088df a3 = k.mo72399a();
                a a4 = this.f212864v.a();
                if (!a4.a) {
                    return C60856cj.m92900i(this.f212864v.b(a4, nVar.mo71342q()));
                }
                this.f212848e.mo72421i(nVar);
                return this.f212853j.mo28210j(this.f212863u.mo71200a(), "[NGA] ShareFulfiller.fulfill.isAccessToCommunicationsAllowed", new C77117eh(this, nVar, emVar3, a3, a4));
            }
        } else {
            C80399l lVar3 = (C80399l) C80401n.f220656k.createBuilder();
            C81442m.m129557s(lVar3, t.r(this.f212859p.mo75121a(nVar.mo71342q()).getString(R.string.nga_phone_settings_cant_take_screenshot_restricted, new Object[0])));
            return C60856cj.m92900i((C80401n) lVar3.build());
        }
    }

    /* renamed from: c */
    public final C60870cx mo72427c(C80399l lVar, C80303ay ayVar, C60870cx cxVar) {
        return this.f212853j.mo28209i(cxVar, "[NGA] ShareFulfiller.addClientOp", new C77115ef(lVar, ayVar));
    }

    /* renamed from: d */
    public final C60870cx mo72428d(String str, C80399l lVar, C80303ay ayVar, C77131l lVar2, C51809dy dyVar) {
        C60870cx g = this.f212867y.g(lVar2.mo72433a());
        C60870cx j = this.f212867y.j(lVar2.mo72433a());
        return this.f212853j.mo28209i(C60856cj.m92907p(j, g), "[NGA] ShareFulfiller.addClientOp", new C77097do(this, dyVar, j, g, str, lVar2, lVar, ayVar));
    }

    /* renamed from: e */
    public final C60870cx mo72429e(C74851z zVar, com.google.android.apps.gsa.nga.engine.aj.af afVar, C52308my myVar) {
        C52373pi piVar = (C52373pi) C52374pj.f137434e.createBuilder();
        if (afVar.s()) {
            String c = zVar.mo71242c();
            piVar.copyOnWrite();
            C52374pj pjVar = (C52374pj) piVar.instance;
            c.getClass();
            pjVar.f137437b = 2;
            pjVar.f137438c = c;
            myVar.copyOnWrite();
            C52374pj pjVar2 = (C52374pj) piVar.build();
            C52321nk nkVar = C52321nk.f137326j;
            pjVar2.getClass();
            ((C52321nk) myVar.instance).f137331d = pjVar2;
            return C60856cj.m92900i((C52321nk) myVar.build());
        }
        return this.f212853j.mo28209i(afVar.B(zVar.mo71241a()), "[NGA] ShareFulfiller.createChatMessageArgs", new C77095dm(piVar, myVar, afVar));
    }

    /* renamed from: g */
    public final C60870cx mo72430g(C77088df dfVar, Uri uri, String str, C80399l lVar) {
        lVar.mo74319k(60742);
        C80293ao aoVar = (C80293ao) C80295aq.f220357c.createBuilder();
        C80338cf cfVar = C80338cf.f220449a;
        aoVar.copyOnWrite();
        C80295aq aqVar = (C80295aq) aoVar.instance;
        cfVar.getClass();
        aqVar.f220360b = cfVar;
        aqVar.f220359a = 7;
        C81442m.m129555q(lVar, aoVar);
        C80303ay ayVar = (C80303ay) C80307bb.f220382e.createBuilder();
        return this.f212853j.mo28210j(this.f212848e.mo72416b(dfVar, ayVar), "[NGA] ShareFulfiller.shareImage2", new C77121el(this, lVar, ayVar, uri, str));
    }

    /* renamed from: h */
    public final C60870cx mo72431h(C77088df dfVar, C74956m mVar) {
        if (!mVar.mo71323c()) {
            return C60856cj.m92900i(Optional.m71637of(this.f212864v.c(mVar, dfVar.mo72405a().mo71342q())));
        }
        C80399l lVar = (C80399l) C80401n.f220656k.createBuilder();
        C80293ao aoVar = (C80293ao) C80295aq.f220357c.createBuilder();
        C80338cf cfVar = C80338cf.f220449a;
        aoVar.copyOnWrite();
        C80295aq aqVar = (C80295aq) aoVar.instance;
        cfVar.getClass();
        aqVar.f220360b = cfVar;
        aqVar.f220359a = 7;
        C81442m.m129555q(lVar, aoVar);
        C80303ay ayVar = (C80303ay) C80307bb.f220382e.createBuilder();
        return this.f212853j.mo28210j(this.f212848e.mo72416b(dfVar, ayVar), "[NGA] ShareFulfiller.shareScreenshot", new C77103du(this, lVar, ayVar));
    }

    /* renamed from: i */
    public final boolean mo72432i() {
        return this.f212854k.mo85405j(C90126fx.f251203eQ);
    }
}
