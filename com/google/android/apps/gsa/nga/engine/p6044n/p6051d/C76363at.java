package com.google.android.apps.gsa.nga.engine.p6044n.p6051d;

import android.content.Context;
import android.os.Bundle;
import android.util.Base64;
import com.google.android.apps.gsa.nga.engine.ae.e;
import com.google.android.apps.gsa.nga.engine.p6044n.C76248a;
import com.google.android.apps.gsa.nga.engine.p6044n.C76287c;
import com.google.android.apps.gsa.nga.engine.p6044n.C76342d;
import com.google.android.apps.gsa.nga.engine.p6044n.C76401e;
import com.google.android.apps.gsa.nga.engine.p6044n.p6045a.C76249a;
import com.google.android.apps.gsa.nga.engine.p6044n.p6045a.C76257b;
import com.google.android.apps.gsa.nga.engine.p6044n.p6045a.C76283c;
import com.google.android.apps.gsa.nga.engine.p6044n.p6045a.p6046a.C76256g;
import com.google.android.apps.gsa.nga.engine.p6044n.p6054f.C76455a;
import com.google.android.apps.gsa.nga.engine.p6056o.C77426t;
import com.google.android.apps.gsa.nga.engine.p6096p.C77437ad;
import com.google.android.apps.gsa.nga.engine.p6096p.C77438ae;
import com.google.android.apps.gsa.nga.engine.p6096p.C77440ag;
import com.google.android.apps.gsa.nga.engine.p6137s.C77908f;
import com.google.android.apps.gsa.nga.engine.p6144ui.C78018a;
import com.google.android.apps.gsa.nga.engine.p6144ui.answer.C78042ao;
import com.google.android.apps.gsa.nga.engine.p6260x.C79853ak;
import com.google.android.apps.gsa.nga.engine.p6260x.p6261a.C79819do;
import com.google.android.apps.gsa.nga.engine.recognition.C77889u;
import com.google.android.apps.gsa.nga.engine.recognition.p6101a.p6102a.C77497a;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.C80391d;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6281e.C80401n;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6295n.C80513b;
import com.google.android.apps.gsa.nga.shared.p6275aa.p6295n.C80517f;
import com.google.android.apps.gsa.nga.shared.p6358n.C81442m;
import com.google.android.apps.gsa.nga.shared.p6407v.C83320io;
import com.google.android.apps.gsa.nga.shared.p6407v.C83334w;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82822bs;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82823bt;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82831ca;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82883dz;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82885ea;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82887ec;
import com.google.android.apps.gsa.nga.shared.p6407v.p6411d.C82988hw;
import com.google.android.apps.gsa.p8883x.C118826c;
import com.google.android.apps.gsa.shared.logger.p7051b.C89849ae;
import com.google.android.apps.gsa.shared.p7066m.C89988b;
import com.google.android.apps.gsa.shared.p7066m.C90074dz;
import com.google.android.apps.gsa.shared.p7066m.C90126fx;
import com.google.android.apps.gsa.shared.util.p7159c.C90873ag;
import com.google.android.apps.gsa.shared.util.p7188v.C91142g;
import com.google.android.libraries.gsa.conversation.p1855h.C22699c;
import com.google.android.libraries.gsa.conversation.p1855h.C22700d;
import com.google.android.libraries.gsa.p1876k.C22871g;
import com.google.android.libraries.p1963i.C23849ax;
import com.google.assistant.p3897e.p3921j.C51715bm;
import com.google.assistant.p3897e.p3921j.C52081en;
import com.google.common.base.C58833ax;
import com.google.common.p4522b.C58370cn;
import com.google.common.p4522b.C58485gu;
import com.google.common.p4522b.C58495hd;
import com.google.common.p4522b.C58528ij;
import com.google.common.p4522b.C58729pv;
import com.google.common.p4526f.p4527a.C58970a;
import com.google.common.p4526f.p4527a.C58974d;
import com.google.common.p4552o.p4566l.C60218r;
import com.google.common.p4552o.p4566l.C60220t;
import com.google.common.util.concurrent.C60826bg;
import com.google.common.util.concurrent.C60856cj;
import com.google.common.util.concurrent.C60870cx;
import com.google.protobuf.C62961ch;
import com.google.protos.p4985f.p5030q.C65163dx;
import com.google.protos.p4985f.p5030q.C65165dz;
import com.google.protos.p4985f.p5030q.C65196fc;
import com.google.protos.p4985f.p5030q.p5034d.p5035a.C65138c;
import com.google.protos.p4985f.p5030q.p5034d.p5035a.C65139d;
import com.google.protos.p5068j.p5069a.p5070a.p5071a.p5072a.p5073a.p5074a.p5075a.C65474a;
import com.google.protos.p5068j.p5069a.p5070a.p5071a.p5072a.p5073a.p5074a.p5075a.C65475b;
import com.google.protos.p5129p.p5131b.C65753ak;
import com.google.protos.p5129p.p5131b.C65767ay;
import com.google.protos.p5129p.p5131b.C65768az;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.concurrent.TimeoutException;
import p3186j$.util.Collection;
import p3186j$.util.Map;
import p3186j$.util.Objects;
import p3186j$.util.Optional;
import p3186j$.util.stream.Collectors;
import p3186j$.util.stream.Stream;

/* renamed from: com.google.android.apps.gsa.nga.engine.n.d.at */
/* compiled from: PG */
public final class C76363at implements C76342d {

    /* renamed from: a */
    public static final C58974d f211461a = C58974d.m91136j();

    /* renamed from: f */
    private static final C58485gu f211462f = C58485gu.m89847o("media.STOP", "media.PAUSE");

    /* renamed from: b */
    public final Context f211463b;

    /* renamed from: c */
    public final C77889u f211464c;

    /* renamed from: d */
    public final C22871g f211465d;

    /* renamed from: e */
    public final C76376bf f211466e;

    /* renamed from: g */
    private final C78018a f211467g;

    /* renamed from: h */
    private final Set f211468h;

    /* renamed from: i */
    private final e f211469i;

    /* renamed from: j */
    private final C77908f f211470j;

    /* renamed from: k */
    private final C22871g f211471k;

    /* renamed from: l */
    private final C22871g f211472l;

    /* renamed from: m */
    private final C83334w f211473m;

    /* renamed from: n */
    private final Set f211474n;

    /* renamed from: o */
    private final C76283c f211475o;

    /* renamed from: p */
    private final C79819do f211476p;

    /* renamed from: q */
    private final C76396v f211477q;

    /* renamed from: r */
    private final Optional f211478r;

    /* renamed from: s */
    private final Set f211479s = new HashSet();

    /* renamed from: t */
    private final C91142g f211480t;

    /* renamed from: u */
    private final C77440ag f211481u;

    /* renamed from: v */
    private final C79853ak f211482v;

    /* renamed from: w */
    private final C77497a f211483w;

    public C76363at(Context context, C77889u uVar, C78018a aVar, Set set, e eVar, C77908f fVar, C22871g gVar, C22871g gVar2, C22871g gVar3, C83334w wVar, Set set2, C76283c cVar, C79819do doVar, C76376bf bfVar, C76396v vVar, Optional optional, C91142g gVar4, C77440ag agVar, C79853ak akVar, C77497a aVar2) {
        this.f211463b = context;
        this.f211464c = uVar;
        this.f211467g = aVar;
        this.f211468h = set;
        this.f211469i = eVar;
        this.f211470j = fVar;
        this.f211471k = gVar;
        this.f211465d = gVar2;
        this.f211472l = gVar3;
        this.f211473m = wVar;
        this.f211474n = set2;
        this.f211475o = cVar;
        this.f211476p = doVar;
        this.f211466e = bfVar;
        this.f211477q = vVar;
        this.f211478r = optional;
        this.f211480t = gVar4;
        this.f211481u = agVar;
        this.f211482v = akVar;
        this.f211483w = aVar2;
    }

    /* renamed from: e */
    private final C60870cx m122975e(C58485gu guVar, C58495hd hdVar, Map map, String str, Optional optional) {
        C76396v vVar = this.f211477q;
        Map map2 = (Map) Collection.EL.stream(guVar).collect(Collectors.partitioningBy(new C76394t()));
        C76343a aVar = new C76343a(vVar.f211536b.mo72185a((List) Map.EL.getOrDefault(map2, true, C58485gu.m89845m()), C58729pv.f156485a), vVar.f211536b.mo72185a((List) Map.EL.getOrDefault(map2, false, C58485gu.m89845m()), hdVar));
        C52081en enVar = aVar.f211435a;
        C60870cx cxVar = C118826c.f331423b;
        if (enVar.f136684d.size() > 0) {
            C76283c cVar = this.f211475o;
            ((C58970a) ((C58970a) C76283c.f211308a.mo56224b()).mo56372aa(3466)).mo56386p("Initializing Assistant object and ConversationSurface");
            C76256g gVar = new C76256g();
            C22700d dVar = new C22700d();
            dVar.f62477b = cVar.f211309b;
            dVar.f62479d = C51715bm.f135662t;
            dVar.mo27830b(cVar.f211310c, cVar.f211311d, cVar.f211312e);
            dVar.f62478c = cVar.f211313f;
            dVar.f62480e = cVar.f211314g;
            dVar.f62476a = gVar;
            dVar.f62485j = C58833ax.m90834k(C23849ax.m44396a(cVar.f211316i));
            dVar.f62484i = C58833ax.m90834k(C23849ax.m44396a(cVar.f211316i));
            C22699c a = dVar.mo27829a();
            cxVar = cVar.f211315h.mo28205e(gVar.f211274a, "[NGA] AssistantWrapper.processConversationDelta", TimeoutException.class, C76249a.f211271a);
            a.mo27701e(new C76257b(enVar));
        }
        C52081en enVar2 = aVar.f211436b;
        C60870cx cxVar2 = C118826c.f331423b;
        if (enVar2.f136684d.size() > 0) {
            cxVar2 = m122976f(this.f211469i.c(str, enVar2, false, optional), map);
        }
        return C118826c.m197212b(C58485gu.m89847o(cxVar, cxVar2));
    }

    /* renamed from: f */
    private final C60870cx m122976f(C60870cx cxVar, java.util.Map map) {
        new C90873ag(cxVar, this.f211472l, "[NGA] maybeExpectAnswerFromOpa", new C76400z(this, map)).mo85223a(C76344aa.f211437a);
        return C118826c.m197213c(cxVar);
    }

    /* renamed from: a */
    public final C60870cx mo72168a(C76401e eVar) {
        C60870cx cxVar;
        C83320io c = eVar.mo72186d().c();
        C76248a aVar = (C76248a) eVar;
        C80401n e = aVar.f211268a.mo72528e();
        if (this.f211479s.contains(e)) {
            this.f211476p.f218883a.mo74237c(C89849ae.NGA_EXECUTION_SKIPPED, c);
            return C118826c.f331423b;
        }
        this.f211479s.add(e);
        this.f211470j.mo72881f(e);
        C79819do doVar = this.f211476p;
        synchronized (doVar.f218884b) {
            doVar.f218885c = c;
        }
        doVar.f218883a.mo74237c(C89849ae.NGA_EXECUTION_START, c);
        C58974d dVar = f211461a;
        ((C58970a) ((C58970a) dVar.mo56224b()).mo56372aa(3542)).mo56354G("Execution for utterance %s/%s", c.f227136c, c.f227135b);
        C82822bs bsVar = (C82822bs) C82823bt.f225680i.createBuilder();
        C82988hw a = C81442m.m129539a(aVar.f211268a.mo72528e());
        bsVar.copyOnWrite();
        C82823bt btVar = (C82823bt) bsVar.instance;
        a.getClass();
        btVar.f225683b = a;
        btVar.f225682a |= 1;
        String q = eVar.mo72187e().mo71163q();
        bsVar.copyOnWrite();
        C82823bt btVar2 = (C82823bt) bsVar.instance;
        q.getClass();
        btVar2.f225682a |= 4;
        btVar2.f225685d = q;
        boolean z = aVar.f211270c;
        bsVar.copyOnWrite();
        C82823bt btVar3 = (C82823bt) bsVar.instance;
        btVar3.f225682a |= 64;
        btVar3.f225689h = z;
        if (aVar.f211268a.mo72525b().mo73747b().isPresent()) {
            C80513b bVar = (C80513b) aVar.f211268a.mo72525b().mo73747b().get();
            bsVar.copyOnWrite();
            C82823bt btVar4 = (C82823bt) bsVar.instance;
            bVar.getClass();
            btVar4.f225684c = bVar;
            btVar4.f225682a |= 2;
        }
        if (aVar.f211268a.mo72525b().mo73746a().mo71160m().isPresent()) {
            bsVar.copyOnWrite();
            C82823bt btVar5 = (C82823bt) bsVar.instance;
            btVar5.f225687f = ((C80517f) aVar.f211268a.mo72525b().mo73746a().mo71160m().get()).getNumber();
            btVar5.f225682a |= 16;
            String r = aVar.f211268a.mo72525b().mo73746a().mo71164r();
            bsVar.copyOnWrite();
            C82823bt btVar6 = (C82823bt) bsVar.instance;
            r.getClass();
            btVar6.f225682a |= 8;
            btVar6.f225686e = r;
        }
        C77426t tVar = aVar.f211268a;
        if ((tVar.mo72527d().f225876a & 4) != 0) {
            C82831ca a2 = C82831ca.m132406a(tVar.mo72527d().f225879d);
            if (a2 == null) {
                a2 = C82831ca.FULFILLMENT_ABORT_FULFILLER_UNKNOWN;
            }
            bsVar.copyOnWrite();
            C82823bt btVar7 = (C82823bt) bsVar.instance;
            btVar7.f225688g = a2.f225800aL;
            btVar7.f225682a |= 32;
        }
        Base64.encodeToString(((C82823bt) bsVar.build()).toByteArray(), 2);
        C83334w wVar = this.f211473m;
        C82887ec ecVar = C82887ec.EXECUTION_SENSITIVE;
        C82883dz dzVar = (C82883dz) C82885ea.f225977c.createBuilder();
        dzVar.copyOnWrite();
        C82885ea eaVar = (C82885ea) dzVar.instance;
        C82823bt btVar8 = (C82823bt) bsVar.build();
        btVar8.getClass();
        eaVar.f225980b = btVar8;
        eaVar.f225979a = 29;
        wVar.mo75545c(ecVar, (C82885ea) dzVar.build(), eVar.mo72186d().c());
        Collection.EL.stream(this.f211474n).forEach(new C76346ac());
        C65196fc fcVar = e.f220666i;
        if (fcVar == null) {
            fcVar = C65196fc.f176453l;
        }
        C52081en enVar = fcVar.f176461g;
        if (enVar == null) {
            enVar = C52081en.f136679i;
        }
        Stream stream = Collection.EL.stream((C58485gu) Collection.EL.stream(enVar.f136684d).map(C76398x.f211538a).collect(C58370cn.f155946a));
        C58485gu guVar = f211462f;
        Objects.requireNonNull(guVar);
        if (stream.anyMatch(new C76399y(guVar))) {
            this.f211483w.mo72591c();
        }
        if (!this.f211478r.isPresent() || ((C76287c) this.f211478r.get()).mo72158a()) {
            if (this.f211480t.mo85405j(C90126fx.f251301gI) && !C81442m.m129547i(((C76248a) eVar).f211268a.mo72528e()).isPresent()) {
                this.f211471k.mo28212l("[NGA] on-device execution toast", new C76347ad(this, eVar));
            }
            C80391d dVar2 = e.f220662e;
            if (dVar2 != null) {
                this.f211467g.mo72968g(new C78042ao(dVar2, new C76348ae(this, eVar, e), new C76349af(this, e, eVar)));
                this.f211476p.f218883a.mo74237c(C89849ae.NGA_CONFIRMATION_UI_RENDERED, eVar.mo72186d().c());
                cxVar = C118826c.f331423b;
            } else {
                cxVar = mo72177c(eVar, e);
            }
        } else {
            ((C58970a) ((C58970a) dVar.mo56224b()).mo56372aa(3544)).mo56386p("Execution skipped due to supplied execution policy.");
            cxVar = C118826c.f331423b;
        }
        Collection.EL.stream(this.f211468h).forEach(new C76362as(eVar));
        return cxVar;
    }

    /* renamed from: b */
    public final C60870cx mo72169b(C58485gu guVar, String str) {
        C58495hd hdVar = C58729pv.f156485a;
        return m122975e(guVar, hdVar, hdVar, str, Optional.empty());
    }

    /* renamed from: c */
    public final C60870cx mo72177c(C76401e eVar, C80401n nVar) {
        C60870cx cxVar;
        Optional optional;
        C60870cx cxVar2;
        C80401n nVar2 = nVar;
        C65196fc fcVar = nVar2.f220666i;
        if (fcVar == null) {
            fcVar = C65196fc.f176453l;
        }
        if ((fcVar.f176455a & 1) != 0) {
            C77440ag agVar = this.f211481u;
            C65196fc fcVar2 = nVar2.f220666i;
            if (fcVar2 == null) {
                fcVar2 = C65196fc.f176453l;
            }
            C65163dx dxVar = fcVar2.f176464j;
            if (dxVar == null) {
                dxVar = C65163dx.f176352b;
            }
            C60218r e = this.f211482v.mo74220e(((C76248a) eVar).f211269b.mo71326a().c());
            ArrayList arrayList = new ArrayList();
            for (C65165dz dzVar : dxVar.f176354a) {
                for (C65768az azVar : dzVar.f176359b) {
                    C76455a aVar = (C76455a) agVar.f213468b.mo27525b();
                    C65753ak b = C65753ak.m96797b(dzVar.f176358a);
                    if (b == null) {
                        b = C65753ak.UNKNOWN;
                    }
                    C65767ay ayVar = (C65767ay) azVar.toBuilder();
                    C65138c cVar = (C65138c) C65139d.f176307e.createBuilder();
                    C60220t tVar = e.f162928b;
                    if (tVar == null) {
                        tVar = C60220t.f162931e;
                    }
                    long j = tVar.f162934b;
                    cVar.copyOnWrite();
                    C65139d dVar = (C65139d) cVar.instance;
                    dVar.f176309a |= 1;
                    dVar.f176310b = j;
                    C60220t tVar2 = e.f162928b;
                    if (tVar2 == null) {
                        tVar2 = C60220t.f162931e;
                    }
                    int i = tVar2.f162935c;
                    cVar.copyOnWrite();
                    C65139d dVar2 = (C65139d) cVar.instance;
                    dVar2.f176309a |= 2;
                    dVar2.f176311c = i;
                    C60220t tVar3 = e.f162928b;
                    if (tVar3 == null) {
                        tVar3 = C60220t.f162931e;
                    }
                    int i2 = tVar3.f162936d;
                    cVar.copyOnWrite();
                    C65139d dVar3 = (C65139d) cVar.instance;
                    dVar3.f176309a |= 4;
                    dVar3.f176312d = i2;
                    ayVar.copyOnWrite();
                    C65768az azVar2 = (C65768az) ayVar.instance;
                    C65139d dVar4 = (C65139d) cVar.build();
                    dVar4.getClass();
                    azVar2.f178796b = dVar4;
                    azVar2.f178795a |= 1;
                    C60870cx f = aVar.mo72195f(b, (C65768az) ayVar.build(), false);
                    C60856cj.m92911t(f, new C77438ae(agVar), C60826bg.f164896a);
                    arrayList.add(f);
                }
            }
            cxVar = C60856cj.m92892a(arrayList).mo57335b(C77437ad.f213464a, C60826bg.f164896a);
        } else {
            cxVar = C118826c.f331423b;
        }
        C60870cx cxVar3 = cxVar;
        if (!this.f211480t.mo85405j(C90126fx.f251462jK)) {
            optional = Optional.empty();
        } else {
            Bundle bundle = new Bundle();
            ((C76248a) eVar).f211269b.mo71338m().ifPresent(new C76350ag(bundle));
            optional = Optional.m71637of(bundle);
        }
        Optional optional2 = optional;
        String q = eVar.mo72187e().mo71163q();
        C76248a aVar2 = (C76248a) eVar;
        C82831ca a = C82831ca.m132406a(aVar2.f211268a.mo72527d().f225879d);
        if (a == null) {
            a = C82831ca.FULFILLMENT_ABORT_FULFILLER_UNKNOWN;
        }
        boolean equals = a.equals(C82831ca.POP);
        C65196fc fcVar3 = nVar2.f220666i;
        if (fcVar3 == null) {
            fcVar3 = C65196fc.f176453l;
        }
        C52081en enVar = fcVar3.f176461g;
        if (enVar == null) {
            enVar = C52081en.f136679i;
        }
        if (!enVar.equals(C52081en.f136679i)) {
            C65196fc fcVar4 = nVar2.f220666i;
            if (fcVar4 == null) {
                fcVar4 = C65196fc.f176453l;
            }
            C62961ch chVar = fcVar4.f176465k;
            if (!chVar.isEmpty() && C58528ij.m90006F(C89988b.m146549b(this.f211480t.mo85403h(C90074dz.f249777f))).containsAll(chVar)) {
                C65196fc fcVar5 = nVar2.f220666i;
                if (fcVar5 == null) {
                    fcVar5 = C65196fc.f176453l;
                }
                C52081en enVar2 = fcVar5.f176461g;
                if (enVar2 == null) {
                    enVar2 = C52081en.f136679i;
                }
                cxVar2 = mo72169b((C58485gu) Collection.EL.stream(enVar2.f136684d).filter(C76359ap.f211457a).map(C76360aq.f211458a).map(C76361ar.f211459a).collect(C58370cn.f155946a), q);
            } else {
                e eVar2 = this.f211469i;
                C65196fc fcVar6 = nVar2.f220666i;
                if (fcVar6 == null) {
                    fcVar6 = C65196fc.f176453l;
                }
                C52081en enVar3 = fcVar6.f176461g;
                if (enVar3 == null) {
                    enVar3 = C52081en.f136679i;
                }
                cxVar2 = m122976f(eVar2.c(q, enVar3, equals, optional2), Collections.unmodifiableMap(nVar2.f220661d));
            }
        } else {
            cxVar2 = C118826c.f331423b;
        }
        C60870cx cxVar4 = cxVar2;
        C60870cx d = mo72178d(nVar, aVar2.f211269b.mo71342q(), eVar.mo72186d().c(), eVar.mo72187e().mo71163q(), optional2);
        if (!C81442m.m129551m(nVar)) {
            this.f211467g.mo72965d();
        }
        return C118826c.m197212b(C58485gu.m89849q(cxVar3, cxVar4, d, C118826c.f331423b));
    }

    /* renamed from: d */
    public final C60870cx mo72178d(C80401n nVar, Locale locale, C83320io ioVar, String str, Optional optional) {
        C60870cx cxVar = C118826c.f331423b;
        C65474a aVar = (C65474a) C65475b.f177978d.createBuilder();
        aVar.copyOnWrite();
        ioVar.getClass();
        ((C65475b) aVar.instance).f177980a = ioVar;
        aVar.copyOnWrite();
        str.getClass();
        ((C65475b) aVar.instance).f177981b = str;
        String languageTag = locale.toLanguageTag();
        aVar.copyOnWrite();
        languageTag.getClass();
        ((C65475b) aVar.instance).f177982c = languageTag;
        C58485gu e = C81442m.m129543e(nVar, (C65475b) aVar.build());
        if (e.isEmpty()) {
            return cxVar;
        }
        return m122975e(e, (C58495hd) Collection.EL.stream(nVar.f220659b).collect(C58370cn.m89403c(C76397w.f211537a, C76351ah.f211448a, C76355al.f211452a)), Collections.unmodifiableMap(nVar.f220661d), str, optional);
    }
}
