package com.google.android.apps.gsa.nga.shared.p6356m.p6357a;

import android.net.Uri;
import com.google.android.apps.gsa.nga.api.C74708bi;
import com.google.android.apps.gsa.nga.api.a.cf;
import com.google.android.apps.gsa.nga.api.bh;
import com.google.android.apps.gsa.nga.engine.C74748a;
import com.google.android.apps.gsa.nga.engine.ay.p;
import com.google.android.apps.gsa.nga.engine.b.b;
import com.google.android.apps.gsa.nga.engine.bisto.C75293b;
import com.google.android.apps.gsa.nga.engine.bisto.a;
import com.google.android.apps.gsa.nga.engine.bisto.d;
import com.google.android.apps.gsa.nga.engine.p5964av.p5967c.p5969b.C75124cc;
import com.google.android.apps.gsa.nga.engine.p5964av.p5967c.p5969b.C75125cd;
import com.google.android.apps.gsa.nga.engine.p5964av.p5967c.p5969b.C75127cj;
import com.google.android.apps.gsa.nga.engine.p5964av.p5967c.p5969b.C75128ck;
import com.google.android.apps.gsa.nga.engine.p5964av.p5967c.p5969b.C75132cs;
import com.google.android.apps.gsa.nga.engine.p5964av.p5967c.p5969b.C75133ct;
import com.google.android.apps.gsa.nga.engine.p5977ay.C75181f;
import com.google.android.apps.gsa.nga.engine.p5977ay.C75182g;
import com.google.android.apps.gsa.nga.shared.p6312ai.p6313a.C80633a;
import com.google.android.apps.gsa.nga.shared.p6312ai.p6313a.C80638b;
import com.google.android.apps.gsa.nga.shared.p6312ai.p6313a.C80640d;
import com.google.android.apps.gsa.nga.shared.p6339f.C81042c;
import com.google.android.apps.gsa.nga.shared.p6339f.p6342c.C81044b;
import com.google.android.apps.gsa.nga.shared.p6339f.p6342c.C81052j;
import com.google.android.apps.gsa.nga.shared.p6339f.p6342c.C81056n;
import com.google.android.apps.gsa.nga.shared.p6339f.p6343d.C81062c;
import com.google.android.apps.gsa.nga.shared.p6339f.p6343d.C81064e;
import com.google.android.apps.gsa.nga.shared.p6339f.p6343d.C81065f;
import com.google.android.apps.gsa.nga.shared.p6407v.p6410c.C82622m;
import com.google.android.apps.gsa.shared.p7066m.C90126fx;
import com.google.android.apps.gsa.shared.speech.HotwordDetectedEventData;
import com.google.android.apps.gsa.shared.speech.hotword.HotwordResult;
import com.google.android.apps.gsa.shared.util.p7159c.C90873ag;
import com.google.android.apps.gsa.shared.util.p7180q.C91081a;
import com.google.android.apps.gsa.shared.util.p7180q.C91084c;
import com.google.android.apps.gsa.shared.util.p7188v.C91142g;
import com.google.android.libraries.search.assistant.invocation.p2655o.p2673i.p2674a.p2675a.p2676a.C34472f;
import com.google.android.libraries.search.assistant.invocation.p2655o.p2673i.p2674a.p2675a.p2676a.C34476j;
import com.google.android.libraries.search.assistant.invocation.p2655o.p2673i.p2674a.p2675a.p2676a.C34478l;
import com.google.android.libraries.search.p2904c.C37360ay;
import com.google.android.libraries.search.p2904c.C37461cj;
import com.google.android.libraries.search.p2904c.C37462ck;
import com.google.android.libraries.search.p2904c.C37466co;
import com.google.android.libraries.search.p2904c.C37467cp;
import com.google.android.libraries.search.p2904c.C37468cq;
import com.google.android.libraries.search.p2904c.C37469cr;
import com.google.android.libraries.search.p2904c.C37500dg;
import com.google.android.libraries.search.p2904c.C37672hs;
import com.google.android.libraries.search.p2904c.p2907ab.C37335b;
import com.google.android.libraries.search.p2904c.p2907ab.C37336c;
import com.google.android.libraries.search.p2904c.p2907ab.C37337d;
import com.google.android.libraries.search.p2904c.p2908b.C37384h;
import com.google.common.base.C58881cr;
import com.google.common.base.C58886cw;
import com.google.common.p4522b.C58425eo;
import com.google.common.p4522b.C58781rt;
import com.google.common.p4526f.p4527a.C58970a;
import com.google.common.p4526f.p4527a.C58974d;
import dagger.C68214a;
import java.util.Queue;
import java.util.Set;
import kotlinx.coroutines.C71424ay;
import kotlinx.coroutines.p5578d.C71663i;
import p3186j$.util.Objects;
import p3186j$.util.Optional;
import p5462h.p5466c.C69577g;
import p5462h.p5473f.p5475b.C69664n;

/* renamed from: com.google.android.apps.gsa.nga.shared.m.a.r */
/* compiled from: PG */
public final class C81417r implements bh {

    /* renamed from: b */
    private static final C58974d f222814b = C58974d.m91136j();

    /* renamed from: a */
    final Queue f222815a = new C58781rt(new C58425eo(10));

    /* renamed from: c */
    private int f222816c;

    /* renamed from: d */
    private final C58881cr f222817d;

    /* renamed from: e */
    private final C81401b f222818e;

    /* renamed from: f */
    private final C81412m f222819f;

    /* renamed from: g */
    private final C81400aq f222820g;

    /* renamed from: h */
    private final C81390ag f222821h;

    /* renamed from: i */
    private final C37337d f222822i;

    /* renamed from: j */
    private final C81064e f222823j;

    /* renamed from: k */
    private final C91142g f222824k;

    public C81417r(C81385ab abVar, C81401b bVar, C81412m mVar, C81400aq aqVar, C81390ag agVar, C37337d dVar, C81064e eVar, C91142g gVar) {
        Objects.requireNonNull(abVar);
        this.f222817d = C58886cw.m90973a(new C81416q(abVar));
        this.f222818e = bVar;
        this.f222819f = mVar;
        this.f222820g = aqVar;
        this.f222821h = agVar;
        this.f222822i = dVar;
        this.f222823j = eVar;
        this.f222824k = gVar;
        this.f222816c = 0;
        C91084c.INTERACTOR.equals(C91081a.m148802a());
    }

    /* renamed from: m */
    private final void m129503m(C37672hs hsVar) {
        if (!this.f222815a.contains(hsVar)) {
            this.f222815a.add(hsVar);
        }
    }

    /* renamed from: a */
    public final C37335b mo75062a(C37360ay ayVar) {
        return this.f222822i.mo40892a(ayVar);
    }

    /* renamed from: b */
    public final void mo75063b(Runnable runnable) {
        if (((Boolean) ((Optional) this.f222817d.mo6453a()).map(C81414o.f222811a).orElse(false)).booleanValue()) {
            Optional map = ((Optional) this.f222817d.mo6453a()).map(C81415p.f222812a);
            if (map.isEmpty()) {
                ((C58970a) ((C58970a) f222814b.mo56226d()).mo56372aa(5890)).mo56386p("Cancel invocation listener is not accessible.");
            } else {
                ((a) ((C68214a) map.get()).mo27525b()).b(runnable);
            }
        }
    }

    /* renamed from: c */
    public final void mo75064c(C37672hs hsVar) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5892)).mo56389s("#onCancelInvocation: %s", hsVar);
        Optional map = ((Optional) this.f222817d.mo6453a()).map(C81415p.f222812a);
        if (!map.isEmpty()) {
            ((a) ((C68214a) map.get()).mo27525b()).a(hsVar);
        }
    }

    /* renamed from: d */
    public final void mo75065d(C37336c cVar, C37672hs hsVar, C81044b bVar) {
        int i;
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5893)).mo56389s("#onFirstStageHotword %s", C81062c.m129010a(Optional.m71637of(hsVar)));
        if (!this.f222823j.mo74838a(hsVar) && !((Optional) this.f222817d.mo6453a()).isEmpty()) {
            m129503m(hsVar);
            if (this.f222824k.mo85405j(C90126fx.f251370hY) && (i = this.f222816c) < 5) {
                this.f222816c = i + 1;
                p pVar = (p) ((C74748a) ((Optional) this.f222819f.f222800b.mo6453a()).get()).mo71129dO().mo27525b();
                pVar.h.mo28212l("[NGA] GsaVISConnection.connectToSearchStack", new C75181f(pVar, C75182g.f209626a));
            }
            C37500dg b = this.f222818e.mo75058b(cVar, hsVar);
            C81412m mVar = this.f222819f;
            p pVar2 = (p) ((C74748a) ((Optional) mVar.f222800b.mo6453a()).get()).mo71129dO().mo27525b();
            mVar.f222807i.mo74374b(mVar.mo75060b(bVar, hsVar));
            C34472f fVar = mVar.f222801c;
            C81052j jVar = bVar.f222120d;
            if (jVar == null) {
                jVar = C81052j.f222154f;
            }
            C81052j jVar2 = jVar;
            C69664n.m101061g(hsVar, "token");
            C69664n.m101061g(b, "bufferId");
            C69664n.m101061g(jVar2, "verificationParams");
            C34478l lVar = (C34478l) fVar;
            new C90873ag(C71663i.m104692e(lVar.f91620c, (C71424ay) null, new C34476j(lVar, b, hsVar, jVar2, (C69577g) null), 3), mVar.f222802d, "[NGA] HeadphoneEntryPoint#onFirstStageHotword", new C81408i(mVar, bVar, hsVar, pVar2)).mo85223a(new C81409j(mVar, hsVar, pVar2));
        }
    }

    /* renamed from: e */
    public final void mo75066e(C37336c cVar, C37672hs hsVar, C81044b bVar) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5894)).mo56389s("#onGacsInvocation %s", C81062c.m129010a(Optional.m71637of(hsVar)));
        if (!this.f222823j.mo74838a(hsVar) && !((Optional) this.f222817d.mo6453a()).isEmpty()) {
            m129503m(hsVar);
            C37500dg b = this.f222818e.mo75058b(cVar, hsVar);
            C81400aq aqVar = this.f222820g;
            C80640d a = aqVar.f222768g.mo74375a(C81400aq.m129479a(hsVar, bVar, b));
            C75133ct ctVar = (C75133ct) ((C74748a) ((Optional) aqVar.f222765d.mo6453a()).get()).mo71136dV().mo27525b();
            new C90873ag(ctVar.f209526a.mo28201a("[NGA] WatchInvocationListenerImpl.onWatchTrigger", new C75132cs(ctVar, a)), aqVar.f222763b, "WatchedEntryPoint", new C81395al(aqVar, hsVar)).mo85223a(new C81396am(aqVar, hsVar));
        }
    }

    /* renamed from: f */
    public final void mo75067f(C37336c cVar, C37672hs hsVar, C81044b bVar) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5895)).mo56389s("#onGestureInvocation %s", C81062c.m129010a(Optional.m71637of(hsVar)));
        if (!((Optional) this.f222817d.mo6453a()).isEmpty() && !this.f222823j.mo74838a(hsVar)) {
            m129503m(hsVar);
            C37500dg b = this.f222818e.mo75058b(cVar, hsVar);
            C81412m mVar = this.f222819f;
            C75125cd cdVar = (C75125cd) ((C74748a) ((Optional) mVar.f222800b.mo6453a()).get()).mo71132dR().mo27525b();
            C81042c cVar2 = mVar.f222804f;
            C81056n nVar = bVar.f222122f;
            if (nVar == null) {
                nVar = C81056n.f222166c;
            }
            if ((nVar.f222168a & 1) != 0) {
                cVar2.f222112a.mo75579d(new C82622m("BISTO_PUSH_TO_TALK_INVOCATION_LATENCY", Double.valueOf((double) (cVar2.f222113b.mo26871c() - nVar.f222169b))));
            }
            C80633a b2 = mVar.mo75060b(bVar, hsVar);
            C37461cj cjVar = (C37461cj) C37462ck.f99442c.createBuilder();
            C37466co coVar = (C37466co) C37467cp.f99458c.createBuilder();
            C37468cq cqVar = (C37468cq) C37469cr.f99462d.createBuilder();
            cqVar.copyOnWrite();
            C37469cr crVar = (C37469cr) cqVar.instance;
            b.getClass();
            crVar.f99466c = b;
            crVar.f99464a |= 2;
            coVar.copyOnWrite();
            C37467cp cpVar = (C37467cp) coVar.instance;
            C37469cr crVar2 = (C37469cr) cqVar.build();
            crVar2.getClass();
            cpVar.f99461b = crVar2;
            cpVar.f99460a = 4;
            cjVar.copyOnWrite();
            C37462ck ckVar = (C37462ck) cjVar.instance;
            C37467cp cpVar2 = (C37467cp) coVar.build();
            cpVar2.getClass();
            ckVar.f99445b = cpVar2;
            ckVar.f99444a |= 1;
            b2.copyOnWrite();
            C80638b bVar2 = (C80638b) b2.instance;
            C37462ck ckVar2 = (C37462ck) cjVar.build();
            C80638b bVar3 = C80638b.f221379o;
            ckVar2.getClass();
            bVar2.f221392l = ckVar2;
            bVar2.f221381a |= 1024;
            new C90873ag(cdVar.f209503a.mo28201a("[NGA] onGestureInvocation", new C75124cc(cdVar, hsVar, mVar.f222806h.mo74375a((C80638b) b2.build()))), mVar.f222802d, "[NGA] HeadphoneEntryPoint#onGestureInvocation", new C81410k(mVar, hsVar)).mo85223a(new C81411l(mVar, hsVar));
        }
    }

    /* renamed from: g */
    public final void mo75068g(C37672hs hsVar) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5896)).mo56389s("manual endpoint for %s", C81062c.m129010a(Optional.m71637of(hsVar)));
        Optional map = ((Optional) this.f222817d.mo6453a()).map(C81413n.f222810a);
        if (!map.isEmpty()) {
            for (C75293b a : (Set) ((C68214a) map.get()).mo27525b()) {
                a.mo71494a(hsVar);
            }
        }
    }

    /* renamed from: h */
    public final void mo75069h(cf cfVar, C37672hs hsVar, HotwordResult hotwordResult, C81044b bVar) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5897)).mo56386p("#onRohanHotwordInvocation");
        C81390ag agVar = this.f222821h;
        agVar.f222740g.mo74374b(C81390ag.m129470a(hsVar, cfVar, bVar));
        if (!((b) ((C74748a) ((Optional) agVar.f222737d.mo6453a()).get()).mo71131dQ().mo27525b()).d(new HotwordDetectedEventData(hotwordResult, (Uri) null))) {
            ((C58970a) ((C58970a) C81390ag.f222734a.mo56226d()).mo56372aa(5904)).mo56354G("NgaEngine.onHotwordEvent failed for %s, %s", C81062c.m129010a(Optional.m71637of(hsVar)), C81065f.m129012a(cfVar));
            agVar.mo75055b(hsVar, 7);
            agVar.f222740g.mo74373a(hsVar);
        }
    }

    /* renamed from: i */
    public final void mo75070i(cf cfVar, C37672hs hsVar, C81044b bVar) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5898)).mo56386p("#onRohanNonHotwordInvocation");
        C81390ag agVar = this.f222821h;
        C80640d a = agVar.f222739f.mo74375a((C80638b) C81390ag.m129470a(hsVar, cfVar, bVar).build());
        C75128ck ckVar = (C75128ck) ((C74748a) ((Optional) agVar.f222737d.mo6453a()).get()).mo71133dS().mo27525b();
        new C90873ag(ckVar.f209515a.mo28201a("[NGA] RohanInvocationListenerImpl.onRohanNonHotwordTrigger", new C75127cj(ckVar, a)), agVar.f222735b, "RohanEntryPoint", new C81386ac(agVar, hsVar, cfVar)).mo85223a(new C81387ad(agVar, hsVar));
    }

    /* renamed from: j */
    public final void mo75071j(C37336c cVar, C37672hs hsVar, boolean z) {
        ((C58970a) ((C58970a) f222814b.mo56224b()).mo56372aa(5899)).mo56389s("#onTranscriptionInvocation %s", C81062c.m129010a(Optional.m71637of(hsVar)));
        if (!((Optional) this.f222817d.mo6453a()).isEmpty() && !this.f222823j.mo74838a(hsVar)) {
            m129503m(hsVar);
            C37500dg b = this.f222818e.mo75058b(cVar, hsVar);
            C81412m mVar = this.f222819f;
            new C90873ag(((d) ((C74748a) ((Optional) mVar.f222800b.mo6453a()).get()).mo71135dU().mo27525b()).b(hsVar, z, b), mVar.f222802d, "[NGA] HeadphoneEntryPoint#onTranscriptionInvocation", new C81404e(mVar, hsVar)).mo85223a(new C81405f(mVar, hsVar));
        }
    }

    /* renamed from: k */
    public final void mo75072k(C74708bi biVar) {
        C81401b bVar = this.f222818e;
        ((C58970a) ((C58970a) C81401b.f222770a.mo56224b()).mo56372aa(5870)).mo56386p("#registerMicController");
        synchronized (bVar.f222774e) {
            if (bVar.f222777h != null) {
                ((C58970a) ((C58970a) C81401b.f222770a.mo56225c()).mo56372aa(5871)).mo56386p("Trying to register micController, but there is already one registered.");
            }
            bVar.f222777h = biVar;
            bVar.f222772c.mo40904b(C37384h.BISTO, bVar);
        }
    }

    /* renamed from: l */
    public final void mo75073l(C74708bi biVar) {
        C81401b bVar = this.f222818e;
        ((C58970a) ((C58970a) C81401b.f222770a.mo56224b()).mo56372aa(5872)).mo56386p("#unregisterMicController");
        synchronized (bVar.f222774e) {
            bVar.f222776g.clear();
            C74708bi biVar2 = bVar.f222777h;
            if (biVar2 == null) {
                ((C58970a) ((C58970a) C81401b.f222770a.mo56226d()).mo56372aa(5874)).mo56386p("unregisterMicController: nothing to unregister");
            } else if (biVar2 != biVar) {
                ((C58970a) ((C58970a) C81401b.f222770a.mo56226d()).mo56372aa(5873)).mo56386p("unregisterMicController: the registered micController is not the same as the one to unregister");
            } else {
                bVar.f222777h = null;
                bVar.f222772c.mo40905c(C37384h.BISTO);
            }
        }
    }
}
