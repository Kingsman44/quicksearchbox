package com.google.android.apps.gsa.staticplugins.opa.tapas.p8475b.p8482g;

import android.content.Context;
import android.location.Location;
import com.google.android.apps.gsa.nga.engine.p6262y.p6271e.p6272a.C80001cv;
import com.google.android.apps.gsa.nga.engine.p6262y.p6271e.p6272a.C80002cw;
import com.google.android.apps.gsa.nga.engine.p6262y.p6271e.p6272a.C80005cz;
import com.google.android.apps.gsa.nga.engine.p6262y.p6271e.p6272a.C80007da;
import com.google.android.apps.gsa.search.core.p6805i.C86124t;
import com.google.android.apps.gsa.shared.p7066m.C90063do;
import com.google.android.apps.gsa.shared.util.p7159c.p7160a.C90851k;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8491c.p8492a.C111248k;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8491c.p8492a.C111255r;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8555l.p8556a.C112145l;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8555l.p8563g.C112471ap;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8555l.p8563g.C112473ar;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8571p.C113025a;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8571p.C113049ax;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8571p.C113090ck;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8571p.C113101n;
import com.google.android.apps.gsa.staticplugins.opa.tapas.shared.C113425ff;
import com.google.android.apps.gsa.staticplugins.opa.tapas.shared.p8579c.C113321r;
import com.google.android.apps.search.assistant.platform.p9171i.p9230e.p9231a.C121537f;
import com.google.android.apps.search.assistant.platform.p9171i.p9230e.p9231a.p9233b.C121509q;
import com.google.android.apps.search.assistant.platform.pcp.p9329f.C123762cb;
import com.google.android.apps.search.assistant.platform.pcp.p9329f.C123766cf;
import com.google.android.libraries.gsa.p1876k.C22871g;
import com.google.android.libraries.p1730f.C21370a;
import com.google.assistant.p3781ad.p3789d.p3791b.C48718bz;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48585aa;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48588ad;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48629br;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48630bs;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48634bw;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48639ca;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48640cb;
import com.google.assistant.p3781ad.p3789d.p3791b.p3792a.C48661v;
import com.google.assistant.p3860as.C49740ac;
import com.google.assistant.p3860as.C49756as;
import com.google.assistant.p3860as.C49758au;
import com.google.assistant.p3860as.C49773bi;
import com.google.assistant.p3860as.C49775bk;
import com.google.assistant.p3860as.C49777bm;
import com.google.assistant.p3861at.C50251qd;
import com.google.common.base.C58881cr;
import com.google.common.p4522b.C58495hd;
import com.google.common.p4522b.C58526ih;
import com.google.common.p4522b.C58528ij;
import com.google.common.p4526f.C59052c;
import com.google.common.p4526f.C59071e;
import com.google.common.util.concurrent.C60826bg;
import com.google.common.util.concurrent.C60846c;
import com.google.common.util.concurrent.C60856cj;
import com.google.common.util.concurrent.C60870cx;
import com.google.common.util.concurrent.C60888db;
import com.google.protobuf.C62942bv;
import com.google.protobuf.C62947c;
import com.google.protobuf.C62971cq;
import com.google.protobuf.C62995dn;
import dagger.C68214a;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.concurrent.Executor;
import p3186j$.time.Duration;
import p3186j$.util.Optional;

/* renamed from: com.google.android.apps.gsa.staticplugins.opa.tapas.b.g.ae */
/* compiled from: PG */
public final class C111136ae extends C112473ar {

    /* renamed from: a */
    public static final C121537f f309392a = C121537f.m200840b("CortexSignalFetcher", C112145l.f311417q);

    /* renamed from: b */
    public static final C59071e f309393b = C59071e.m91332i("com.google.android.apps.gsa.staticplugins.opa.tapas.b.g.ae");

    /* renamed from: c */
    public final C68214a f309394c;

    /* renamed from: d */
    public final C68214a f309395d;

    /* renamed from: e */
    public final Context f309396e;

    /* renamed from: f */
    public final C68214a f309397f;

    /* renamed from: g */
    public final C68214a f309398g;

    /* renamed from: h */
    public final C21370a f309399h;

    /* renamed from: i */
    public final C68214a f309400i;

    /* renamed from: j */
    public final C58881cr f309401j;

    /* renamed from: k */
    private final C86124t f309402k;

    /* renamed from: l */
    private final C68214a f309403l;

    /* renamed from: m */
    private final C22871g f309404m;

    /* renamed from: n */
    private final C68214a f309405n;

    /* renamed from: o */
    private final C68214a f309406o;

    /* renamed from: p */
    private final C68214a f309407p;

    /* renamed from: q */
    private final boolean f309408q;

    public C111136ae(C86124t tVar, C68214a aVar, C68214a aVar2, C68214a aVar3, C22871g gVar, Context context, C68214a aVar4, C68214a aVar5, C68214a aVar6, C68214a aVar7, C21370a aVar8, C68214a aVar9, C68214a aVar10, C58881cr crVar) {
        this.f309402k = tVar;
        this.f309394c = aVar;
        this.f309395d = aVar2;
        this.f309403l = aVar3;
        this.f309404m = gVar;
        this.f309400i = aVar10;
        this.f309401j = crVar;
        this.f309396e = context;
        this.f309397f = aVar4;
        this.f309398g = aVar5;
        this.f309405n = aVar6;
        this.f309406o = aVar7;
        this.f309399h = aVar8;
        this.f309407p = aVar9;
        this.f309408q = tVar.mo79746e(C90063do.f249601gc);
    }

    /* renamed from: g */
    public static Boolean m184906g(double d, double d2, C50251qd qdVar) {
        boolean z = true;
        float[] fArr = new float[1];
        Location.distanceBetween(d, d2, qdVar.f130680c, qdVar.f130681d, fArr);
        if (((double) fArr[0]) >= 200.0d) {
            z = false;
        }
        return Boolean.valueOf(z);
    }

    /* renamed from: h */
    public static void m184907h(C80005cz czVar, String str) {
        C80001cv cvVar = (C80001cv) C80002cw.f219485c.createBuilder();
        cvVar.copyOnWrite();
        C80002cw cwVar = (C80002cw) cvVar.instance;
        str.getClass();
        cwVar.f219487a |= 1;
        cwVar.f219488b = str;
        C80002cw cwVar2 = (C80002cw) cvVar.build();
        czVar.copyOnWrite();
        C80007da daVar = (C80007da) czVar.instance;
        C80007da daVar2 = C80007da.f219520C;
        cwVar2.getClass();
        daVar.f219549z = cwVar2;
        daVar.f219524a |= 268435456;
    }

    /* renamed from: i */
    private static C58495hd m184908i(C123762cb cbVar, Optional optional) {
        HashMap hashMap = new HashMap();
        if (optional.isEmpty()) {
            return C58495hd.m89898l(hashMap);
        }
        for (C48639ca caVar : ((C48640cb) optional.get()).f125719a) {
            C123766cf cfVar = caVar.f125715a;
            if (cfVar == null) {
                cfVar = C123766cf.f341884i;
            }
            C123762cb a = C123762cb.m203107a(cfVar.f341891f);
            if (a == null) {
                a = C123762cb.AFFINITY_TYPE_UNSPECIFIED;
            }
            if (a == cbVar) {
                for (C113321r rVar : caVar.f125716b) {
                    if (hashMap.containsKey(rVar.f313838e)) {
                        String str = rVar.f313838e;
                        Double d = (Double) hashMap.get(str);
                        d.getClass();
                        double doubleValue = d.doubleValue();
                        C123766cf cfVar2 = caVar.f125715a;
                        if (cfVar2 == null) {
                            cfVar2 = C123766cf.f341884i;
                        }
                        hashMap.put(str, Double.valueOf(Math.max(doubleValue, cfVar2.f341892g)));
                    } else {
                        String str2 = rVar.f313838e;
                        C123766cf cfVar3 = caVar.f125715a;
                        if (cfVar3 == null) {
                            cfVar3 = C123766cf.f341884i;
                        }
                        hashMap.put(str2, Double.valueOf(cfVar3.f341892g));
                    }
                }
            }
        }
        return C58495hd.m89898l(hashMap);
    }

    /* renamed from: j */
    private static C60870cx m184909j(C112471ap apVar, C48634bw bwVar, Executor executor) {
        return C60846c.m92878g(apVar.f311989a.mo99547a(bwVar), Throwable.class, new C111158w(bwVar), executor);
    }

    /* renamed from: a */
    public final long mo99043a() {
        return Duration.ofMinutes(1).toMillis();
    }

    /* renamed from: b */
    public final C60870cx mo99044b() {
        C60888db c = ((C90851k) this.f309406o.mo27525b()).mo85210c("TapasLightweightExecutor");
        C60826bg bgVar = C60826bg.f164896a;
        C112471ap apVar = (C112471ap) this.f309407p.mo27525b();
        C60870cx j = m184909j(apVar, C48634bw.TAPAS_USER_PROFILE, bgVar);
        C60870cx a = C113090ck.m187088a(this.f309402k, (C113425ff) this.f309405n.mo27525b(), this.f309404m);
        C60870cx j2 = m184909j(apVar, C48634bw.APP_USAGE_SIGNAL, bgVar);
        return C60856cj.m92893b(j, a, j2).mo57334a(new C111147l(this, j, j2, a), c);
    }

    /* renamed from: e */
    public final C80007da mo99047e(Optional optional, Optional optional2, Optional optional3, Optional optional4, Optional optional5, Optional optional6) {
        return (C80007da) f309392a.mo105235d("createUserContext", new C111159x(this, optional, optional2, optional3, optional4, optional5, optional6));
    }

    /* renamed from: f */
    public final C48588ad mo99048f(Optional optional, boolean z, Optional optional2, Optional optional3, Optional optional4, Optional optional5, Optional optional6) {
        C58528ij ijVar;
        Throwable th;
        C121509q l;
        Throwable th2;
        int i;
        C49758au auVar;
        C49758au auVar2;
        C49756as asVar;
        C49756as asVar2;
        Optional optional7 = optional2;
        C58495hd i2 = m184908i(C123762cb.TEXT, optional7);
        C58495hd i3 = m184908i(C123762cb.CALL, optional7);
        C58526ih ihVar = new C58526ih();
        if (optional3.isEmpty()) {
            ijVar = ihVar.mo55486f();
        } else {
            for (C48629br brVar : ((C48630bs) optional3.get()).f125674a) {
                for (C113321r rVar : brVar.f125671a) {
                    ihVar.mo55373c(rVar.f313838e);
                }
            }
            ijVar = ihVar.mo55486f();
        }
        int i4 = 1;
        if (optional4.isPresent()) {
            C49740ac acVar = (C49740ac) optional4.get();
            C111248k kVar = (C111248k) this.f309403l.mo27525b();
            int i5 = 0;
            kVar.mo99076a(C111255r.CORTEX_LOG, String.format("Number of habits profile top android app activities: %d", new Object[]{Integer.valueOf(acVar.f128436c.size())}));
            Iterator it = acVar.f128436c.iterator();
            int i6 = 0;
            while (true) {
                i = 3;
                if (!it.hasNext()) {
                    break;
                }
                C49777bm bmVar = (C49777bm) it.next();
                if (bmVar.f128537b == 6) {
                    asVar = (C49756as) bmVar.f128538c;
                } else {
                    asVar = C49756as.f128486c;
                }
                if ((asVar.f128488a & i4) != 0) {
                    i6++;
                    if (i6 > 3) {
                        break;
                    }
                    C111255r rVar2 = C111255r.CORTEX_LOG;
                    Object[] objArr = new Object[3];
                    objArr[0] = Integer.valueOf(i6);
                    if (bmVar.f128537b == 6) {
                        asVar2 = (C49756as) bmVar.f128538c;
                    } else {
                        asVar2 = C49756as.f128486c;
                    }
                    objArr[i4] = asVar2.f128489b;
                    C49773bi biVar = bmVar.f128539d;
                    if (biVar == null) {
                        biVar = C49773bi.f128525b;
                    }
                    objArr[2] = Double.valueOf(biVar.f128527a);
                    kVar = kVar;
                    kVar.mo99076a(rVar2, String.format("Top android app activities #%d: %s, score: %f", objArr));
                    i4 = 1;
                }
            }
            kVar.mo99076a(C111255r.CORTEX_LOG, String.format("Number of habits profile top assistant activities: %d", new Object[]{Integer.valueOf(acVar.f128435b.size())}));
            int i7 = 0;
            for (C49777bm bmVar2 : acVar.f128435b) {
                if (bmVar2.f128537b == 1 && ((C49758au) bmVar2.f128538c).f128492a.size() != 0) {
                    i7++;
                    if (i7 > i) {
                        break;
                    }
                    C111255r rVar3 = C111255r.CORTEX_LOG;
                    Object[] objArr2 = new Object[4];
                    objArr2[i5] = Integer.valueOf(i7);
                    if (bmVar2.f128537b == 1) {
                        auVar = (C49758au) bmVar2.f128538c;
                    } else {
                        auVar = C49758au.f128490b;
                    }
                    objArr2[1] = ((C49775bk) auVar.f128492a.get(i5)).f128531a;
                    C49773bi biVar2 = bmVar2.f128539d;
                    if (biVar2 == null) {
                        biVar2 = C49773bi.f128525b;
                    }
                    objArr2[2] = Double.valueOf(biVar2.f128527a);
                    if (bmVar2.f128537b == 1) {
                        auVar2 = (C49758au) bmVar2.f128538c;
                    } else {
                        auVar2 = C49758au.f128490b;
                    }
                    objArr2[3] = Integer.valueOf(((C49775bk) auVar2.f128492a.get(0)).f128532b);
                    kVar.mo99076a(rVar3, String.format("Top assistant activities #%d: %s, score: %f, occurrences: %d", objArr2));
                }
                i5 = 0;
                i = 3;
            }
        }
        C48585aa aaVar = (C48585aa) C48588ad.f125578i.createBuilder();
        aaVar.copyOnWrite();
        C48588ad adVar = (C48588ad) aaVar.instance;
        C62995dn dnVar = adVar.f125582c;
        if (!dnVar.f170058b) {
            adVar.f125582c = dnVar.mo58980a();
        }
        adVar.f125582c.putAll(i2);
        aaVar.copyOnWrite();
        C48588ad adVar2 = (C48588ad) aaVar.instance;
        C62995dn dnVar2 = adVar2.f125583d;
        if (!dnVar2.f170058b) {
            adVar2.f125583d = dnVar2.mo58980a();
        }
        adVar2.f125583d.putAll(i3);
        aaVar.copyOnWrite();
        C48588ad adVar3 = (C48588ad) aaVar.instance;
        C62971cq cqVar = adVar3.f125584e;
        if (!cqVar.mo58948c()) {
            adVar3.f125584e = C62942bv.mutableCopy(cqVar);
        }
        C62947c.addAll((Iterable) ijVar, (List) adVar3.f125584e);
        if (optional5.isPresent()) {
            C48661v vVar = (C48661v) optional5.get();
            aaVar.copyOnWrite();
            C48588ad adVar4 = (C48588ad) aaVar.instance;
            vVar.getClass();
            adVar4.f125581b = vVar;
            adVar4.f125580a |= 1;
        }
        if (optional4.isPresent()) {
            C49740ac acVar2 = (C49740ac) optional4.get();
            aaVar.copyOnWrite();
            C48588ad adVar5 = (C48588ad) aaVar.instance;
            acVar2.getClass();
            adVar5.f125585f = acVar2;
            adVar5.f125580a |= 2;
        }
        if (optional6.isPresent()) {
            C80007da daVar = (C80007da) optional6.get();
            aaVar.copyOnWrite();
            C48588ad adVar6 = (C48588ad) aaVar.instance;
            daVar.getClass();
            adVar6.f125587h = daVar;
            adVar6.f125580a |= 8;
        }
        if (this.f309408q && optional.isPresent() && z) {
            try {
                C121537f fVar = f309392a;
                C121509q l2 = fVar.mo105243l("precompute_user_profile_with_fetch");
                try {
                    C62971cq cqVar2 = ((C48718bz) optional.get()).f126053a;
                    if (this.f309402k.mo79746e(C90063do.f249536fQ)) {
                        cqVar2 = C113025a.m187025a().f126053a;
                    }
                    l = fVar.mo105243l("precompute_user_profile");
                    C113101n a = C113049ax.m187033b(cqVar2).mo99823a();
                    aaVar.copyOnWrite();
                    C48588ad adVar7 = (C48588ad) aaVar.instance;
                    a.getClass();
                    adVar7.f125586g = a;
                    adVar7.f125580a |= 4;
                    l.close();
                    l2.close();
                } catch (Throwable th3) {
                    th = th3;
                    l2.close();
                    throw th;
                }
            } catch (RuntimeException e) {
                ((C59052c) ((C59052c) ((C59052c) f309393b.mo56225c()).mo56382g(e)).mo56372aa(27116)).mo56389s("Failed to precompute user profile stats: %s", e);
                f309392a.mo105240i("PrecomputedUserProfileFeatureStats_from_exception");
            } catch (Throwable th4) {
                C111131a.m184903a(th, th4);
            }
        }
        return (C48588ad) aaVar.build();
        throw th2;
    }
}
