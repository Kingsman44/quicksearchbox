package com.google.android.apps.gsa.staticplugins.opa.tapas.datasource.p8500a.p8503c;

import android.text.TextUtils;
import com.evernote.android.state.BuildConfig;
import com.google.android.apps.gsa.search.core.p6805i.C86124t;
import com.google.android.apps.gsa.shared.p7066m.C90035cn;
import com.google.android.apps.gsa.shared.p7066m.C90063do;
import com.google.android.apps.gsa.shared.util.debug.p7163a.C90991b;
import com.google.android.apps.gsa.shared.util.debug.p7163a.C91006f;
import com.google.android.apps.gsa.shared.util.p7159c.C90877ak;
import com.google.android.apps.gsa.shared.util.p7159c.p7160a.C90851k;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8471a.C110972aj;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8471a.C111014bk;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8471a.C111015bl;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8471a.C111016bm;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8471a.C111029bz;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8540g.p8541a.C112021a;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8572q.C113126ak;
import com.google.android.apps.gsa.staticplugins.opa.tapas.p8572q.C113206m;
import com.google.android.apps.gsa.staticplugins.opa.tapas.shared.C113405ep;
import com.google.android.apps.gsa.staticplugins.opa.tapas.shared.C113408es;
import com.google.android.apps.gsa.staticplugins.opa.tapas.shared.C113409et;
import com.google.android.apps.gsa.staticplugins.opa.tapas.shared.C113415ez;
import com.google.android.apps.search.assistant.platform.p9171i.p9230e.p9231a.C121492b;
import com.google.android.apps.search.assistant.platform.p9171i.p9230e.p9231a.C121537f;
import com.google.android.apps.search.assistant.platform.p9171i.p9230e.p9231a.p9233b.C121509q;
import com.google.android.libraries.assistant.p1594s.p1597b.C19166b;
import com.google.android.libraries.assistant.p1594s.p1597b.C19193u;
import com.google.android.libraries.assistant.p1594s.p1597b.C19195w;
import com.google.apps.tiktok.tracing.C47810es;
import com.google.assistant.p3781ad.p3789d.p3791b.C48672ag;
import com.google.assistant.p3781ad.p3789d.p3791b.C48674ai;
import com.google.assistant.p3781ad.p3789d.p3791b.C48712bt;
import com.google.assistant.p3825an.p3830c.p3831a.C49261ag;
import com.google.assistant.p3825an.p3830c.p3831a.C49270ap;
import com.google.assistant.p3825an.p3830c.p3831a.C49271aq;
import com.google.assistant.p3825an.p3830c.p3831a.C49301bt;
import com.google.assistant.p3825an.p3830c.p3831a.C49308c;
import com.google.common.base.C58835az;
import com.google.common.base.C58881cr;
import com.google.common.base.C58886cw;
import com.google.common.p4522b.C58370cn;
import com.google.common.p4522b.C58485gu;
import com.google.common.p4522b.C58528ij;
import com.google.common.p4522b.C58733pz;
import com.google.common.p4526f.C58976aa;
import com.google.common.p4526f.C59071e;
import com.google.common.p4526f.p4527a.C58975e;
import com.google.common.p4535g.C59203do;
import com.google.common.util.concurrent.C60826bg;
import com.google.common.util.concurrent.C60856cj;
import com.google.common.util.concurrent.C60870cx;
import com.google.common.util.concurrent.C60922j;
import com.google.p4129b.p4136c.C54761i;
import com.google.protobuf.C62971cq;
import dagger.C68214a;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Locale;
import java.util.Map;
import java.util.concurrent.Executor;
import p3186j$.util.Collection;
import p3186j$.util.Optional;

/* renamed from: com.google.android.apps.gsa.staticplugins.opa.tapas.datasource.a.c.ao */
/* compiled from: PG */
public final class C111346ao extends C113409et implements C90991b {

    /* renamed from: a */
    public static final C59071e f309833a = C59071e.m91332i("com.google.android.apps.gsa.staticplugins.opa.tapas.datasource.a.c.ao");

    /* renamed from: b */
    public static final C121537f f309834b = C121537f.m200840b("TapasAppActionsShortcutSource", C113409et.f314037l);

    /* renamed from: c */
    public final C68214a f309835c;

    /* renamed from: d */
    public final C68214a f309836d;

    /* renamed from: e */
    public final C86124t f309837e;

    /* renamed from: f */
    public final C68214a f309838f;

    /* renamed from: g */
    public final C68214a f309839g;

    /* renamed from: h */
    public final C68214a f309840h;

    /* renamed from: i */
    public final C68214a f309841i;

    /* renamed from: j */
    public final C68214a f309842j;

    /* renamed from: k */
    private final C68214a f309843k;

    /* renamed from: m */
    private final C68214a f309844m;

    /* renamed from: n */
    private final C68214a f309845n;

    /* renamed from: o */
    private final Executor f309846o;

    /* renamed from: p */
    private final C68214a f309847p;

    /* renamed from: q */
    private final C58881cr f309848q;

    public C111346ao(C68214a aVar, C68214a aVar2, C68214a aVar3, C86124t tVar, C68214a aVar4, C68214a aVar5, C68214a aVar6, C68214a aVar7, C68214a aVar8, C90851k kVar, C68214a aVar9, C68214a aVar10, C68214a aVar11, C68214a aVar12) {
        this.f309843k = aVar;
        this.f309835c = aVar2;
        this.f309836d = aVar3;
        this.f309837e = tVar;
        this.f309845n = aVar4;
        this.f309844m = aVar5;
        this.f309838f = aVar6;
        this.f309839g = aVar7;
        this.f309840h = aVar8;
        this.f309841i = aVar9;
        this.f309842j = aVar10;
        this.f309848q = C58886cw.m90973a(new C111338ag(aVar11));
        this.f309847p = aVar12;
        if (tVar.mo79746e(C90063do.f249343bj)) {
            this.f309846o = kVar.mo85210c("TapasLightweightExecutor");
        } else {
            this.f309846o = C60826bg.f164896a;
        }
    }

    /* renamed from: i */
    private final double m185100i(C113405ep epVar, String str, boolean z) {
        double d;
        double c = ((C113126ak) this.f309845n.mo27525b()).mo99889c(epVar, str, epVar.mo100033p().toLowerCase(Locale.getDefault()).trim());
        if (z) {
            d = this.f309837e.mo79747m(C90063do.f249649y);
        } else {
            d = this.f309837e.mo79747m(C90063do.f249233F);
        }
        return c < d ? C59203do.f157270a : c;
    }

    /* renamed from: j */
    private final C58485gu m185101j() {
        C58528ij ijVar;
        C121509q l = f309834b.mo105243l("getOnDeviceAppActions");
        C58485gu b = ((C111029bz) this.f309843k.mo27525b()).mo99019b(this.f309837e.mo79746e(C90063do.f249341bh));
        l.close();
        if (this.f309837e.mo79746e(C90035cn.f248377b)) {
            ijVar = (C58528ij) this.f309848q.mo6453a();
        } else {
            ijVar = C58733pz.f156496a;
        }
        C58485gu guVar = (C58485gu) Collection.EL.stream(b).filter(new C111389y(ijVar, this.f309837e.mo79745c(C90035cn.f248376a))).collect(C58370cn.f155946a);
        long a = this.f309837e.mo79743a(C90063do.f249230C);
        return a < ((long) guVar.size()) ? guVar.subList(0, (int) a) : guVar;
    }

    /* renamed from: a */
    public final C48672ag mo99101a() {
        return C48672ag.APP_ACTIONS_SHORTCUT;
    }

    /* renamed from: b */
    public final C60870cx mo99109b(C49301bt btVar, C113405ep epVar, C49270ap apVar, Map map) {
        boolean z;
        double d;
        Optional optional;
        C49301bt btVar2 = btVar;
        C113405ep epVar2 = epVar;
        C49270ap apVar2 = apVar;
        String trim = epVar.mo100033p().toLowerCase(Locale.getDefault()).trim();
        String str = apVar2.f127356b;
        String str2 = btVar2.f127426b;
        if (epVar.mo100024h().equals(C48674ai.GEMINI)) {
            C19195w wVar = epVar.mo100022f().f53690r;
            if (wVar == null) {
                wVar = C19195w.f53744e;
            }
            C19166b bVar = wVar.f53748c;
            if (bVar == null) {
                bVar = C19166b.f53665d;
            }
            z = bVar.f53668b.contains(str2);
        } else {
            z = this.f309837e.mo79745c(C90063do.f249646v).contains(str2);
        }
        if (z) {
            return C60856cj.m92900i(C113415ez.f314042L);
        }
        boolean z2 = true;
        if (epVar.mo100022f().f53686n) {
            Optional empty = Optional.empty();
            C19195w wVar2 = epVar.mo100022f().f53690r;
            if (wVar2 == null) {
                wVar2 = C19195w.f53744e;
            }
            C19166b bVar2 = wVar2.f53748c;
            if (bVar2 == null) {
                bVar2 = C19166b.f53665d;
            }
            if (bVar2.f53667a) {
                empty = ((C113206m) this.f309844m.mo27525b()).mo99851j(str2);
            }
            C19195w wVar3 = epVar.mo100022f().f53690r;
            if (wVar3 == null) {
                wVar3 = C19195w.f53744e;
            }
            C19166b bVar3 = wVar3.f53748c;
            if (bVar3 == null) {
                bVar3 = C19166b.f53665d;
            }
            int a = C19193u.m36587a(bVar3.f53669c);
            if (a == 0 || a != 3) {
                z2 = false;
            }
            C48712bt a2 = ((C112021a) this.f309847p.mo27525b()).mo99338a(trim, (String) empty.orElse(BuildConfig.FLAVOR), str, z2);
            double max = Math.max(a2.f126028c, a2.f126029d);
            if (max < 1.0E-4d) {
                return C60856cj.m92899h(new Exception("match score below threshold"));
            }
            C58976aa aaVar = C58975e.f156826a;
            empty.orElse(BuildConfig.FLAVOR);
            double d2 = a2.f126027b;
            return mo99110e(epVar, btVar, str, apVar, max, map);
        }
        C58976aa aaVar2 = C58975e.f156826a;
        double i = m185100i(epVar2, str, false);
        if (this.f309837e.mo79746e(C90063do.f249342bi)) {
            C49261ag agVar = btVar2.f127427c;
            if (agVar == null) {
                agVar = C49261ag.f127334e;
            }
            d = Math.max(i, m185100i(epVar2, agVar.f127336a, true));
        } else {
            d = i;
        }
        if (d > C59203do.f157270a) {
            return C60922j.m93044g(mo99110e(epVar, btVar, str, apVar, d, map), C47810es.m84963c(new C111378n(this, str2)), this.f309846o);
        }
        C113126ak akVar = (C113126ak) this.f309845n.mo27525b();
        if (epVar.mo100022f().f53687o) {
            if (!TextUtils.isEmpty(trim)) {
                String lowerCase = trim.trim().toLowerCase(Locale.getDefault());
                Iterator it = apVar2.f127357c.iterator();
                while (true) {
                    if (!it.hasNext()) {
                        optional = Optional.empty();
                        break;
                    }
                    String str3 = (String) it.next();
                    double c = akVar.mo99889c(epVar2, str3.trim().toLowerCase(Locale.getDefault()), lowerCase);
                    if (c < akVar.f313428b.mo79747m(C90063do.f249647w)) {
                        c = 0.0d;
                    }
                    if (c > C59203do.f157270a) {
                        optional = Optional.m71637of(new C58835az(str3, Double.valueOf(c)));
                        break;
                    }
                }
            } else {
                optional = Optional.empty();
            }
        } else {
            optional = Optional.empty();
        }
        if (optional.isEmpty()) {
            return C60856cj.m92899h(new Exception("no shortcuts found"));
        }
        return C60922j.m93044g(mo99110e(epVar, btVar, (String) ((C58835az) optional.get()).f156631a, apVar, ((Double) ((C58835az) optional.get()).f156632b).doubleValue(), map), C47810es.m84963c(new C111379o(this, str2)), this.f309846o);
    }

    /* renamed from: c */
    public final C60870cx mo99103c(C113405ep epVar, Map map) {
        C60870cx cxVar;
        C121537f fVar = f309834b;
        C121492b a = fVar.mo105233a("fetchSuggestionsThrottled");
        String trim = epVar.mo100033p().toLowerCase(Locale.getDefault()).trim();
        C58976aa aaVar = C58975e.f156826a;
        if (!epVar.mo100031n().isPresent() && (((long) trim.length()) < this.f309837e.mo79743a(C90063do.f249232E) || ((long) trim.length()) > this.f309837e.mo79743a(C90063do.f249231D))) {
            return C60856cj.m92900i(C113408es.f314036b);
        }
        if (!epVar.mo100031n().isPresent()) {
            epVar.mo100033p().toLowerCase(Locale.getDefault()).trim();
            C121492b a2 = fVar.mo105233a("fetchSuggestions");
            if (this.f309837e.mo79746e(C90063do.f249327bT)) {
                C60870cx c = ((C113206m) this.f309844m.mo27525b()).mo99844c();
                if (C90877ak.m148480n(c)) {
                    cxVar = mo99112g((Map) C90877ak.m148474h(c), epVar);
                } else {
                    C60870cx c2 = ((C113206m) this.f309844m.mo27525b()).mo99844c();
                    C111335ad adVar = new C111335ad(this, epVar);
                    cxVar = C60922j.m93045h(c2, C47810es.m84966f(adVar), this.f309846o);
                }
            } else {
                cxVar = mo99112g(new HashMap(), epVar);
            }
            C60856cj.m92911t(cxVar, new C111345an(a2), this.f309846o);
        } else if (this.f309837e.mo79746e(C90063do.f249327bT)) {
            C60870cx c3 = ((C113206m) this.f309844m.mo27525b()).mo99844c();
            if (C90877ak.m148480n(c3)) {
                cxVar = mo99113h((Map) C90877ak.m148474h(c3));
            } else {
                C60870cx c4 = ((C113206m) this.f309844m.mo27525b()).mo99844c();
                C111377m mVar = new C111377m(this);
                cxVar = C60922j.m93045h(c4, C47810es.m84966f(mVar), this.f309846o);
            }
        } else {
            cxVar = mo99113h(new HashMap());
        }
        C60856cj.m92911t(cxVar, new C111344am(a), this.f309846o);
        C111376l lVar = C111376l.f309900a;
        return C60922j.m93044g(cxVar, C47810es.m84963c(lVar), this.f309846o);
    }

    /* renamed from: e */
    public final C60870cx mo99110e(C113405ep epVar, C49301bt btVar, String str, C49270ap apVar, double d, Map map) {
        C60870cx cxVar;
        C60870cx cxVar2;
        C49301bt btVar2 = btVar;
        C49270ap apVar2 = apVar;
        if (TextUtils.isEmpty(str)) {
            C58976aa aaVar = C58975e.f156826a;
            return C60856cj.m92899h(new IllegalArgumentException("displayText is empty."));
        } else if ((apVar2.f127355a & 4) != 0) {
            C49308c cVar = apVar2.f127359e;
            if (cVar == null) {
                cVar = C49308c.f127443c;
            }
            C49308c cVar2 = cVar;
            C54761i iVar = btVar2.f127429e;
            if (iVar == null) {
                iVar = C54761i.f143683c;
            }
            C62971cq cqVar = iVar.f143685a;
            String str2 = cVar2.f127445a;
            if (TextUtils.isEmpty(str2)) {
                C58976aa aaVar2 = C58975e.f156826a;
                return C60856cj.m92899h(new IllegalArgumentException("intentName is empty"));
            }
            Optional findFirst = Collection.EL.stream(cqVar).filter(new C111384t(str2)).map(C111385u.f309911a).findFirst();
            String str3 = btVar2.f127426b;
            if (findFirst.isEmpty()) {
                C58976aa aaVar3 = C58975e.f156826a;
                return C60856cj.m92899h(new IllegalArgumentException("fulfillment is empty"));
            }
            C58976aa aaVar4 = C58975e.f156826a;
            C19195w wVar = epVar.mo100022f().f53690r;
            if (wVar == null) {
                wVar = C19195w.f53744e;
            }
            C19166b bVar = wVar.f53748c;
            if (bVar == null) {
                bVar = C19166b.f53665d;
            }
            if (bVar.f53667a) {
                C111029bz bzVar = (C111029bz) this.f309843k.mo27525b();
                Optional map2 = bzVar.f309216c.mo99533d().flatMap(new C111014bk(str3)).map(C111015bl.f309197a);
                if (map2.isEmpty()) {
                    C60870cx c = bzVar.f309218e.mo99926c(str3);
                    C111016bm bmVar = C111016bm.f309198a;
                    cxVar2 = C60922j.m93044g(c, C47810es.m84963c(bmVar), bzVar.f309217d);
                } else {
                    cxVar2 = C60856cj.m92900i(map2);
                }
                C111386v vVar = new C111386v(btVar2);
                cxVar = C60922j.m93044g(cxVar2, C47810es.m84963c(vVar), this.f309846o);
            } else {
                C49261ag agVar = btVar2.f127427c;
                if (agVar == null) {
                    agVar = C49261ag.f127334e;
                }
                cxVar = C60856cj.m92900i(agVar.f127336a);
            }
            C60870cx cxVar3 = cxVar;
            C111388x xVar = new C111388x(this, epVar, str, str3, btVar, apVar, findFirst, cVar2, map, d);
            return C60922j.m93044g(cxVar3, C47810es.m84963c(xVar), this.f309846o);
        } else {
            C58976aa aaVar5 = C58975e.f156826a;
            return C60856cj.m92899h(new IllegalArgumentException("action intent is empty."));
        }
    }

    /* renamed from: f */
    public final C60870cx mo99111f(C49301bt btVar, C113405ep epVar, Map map) {
        boolean e = this.f309837e.mo79746e(C90063do.f249485eS);
        C49271aq aqVar = btVar.f127428d;
        if (aqVar == null) {
            aqVar = C49271aq.f127363b;
        }
        return C60856cj.m92906o((Iterable) Collection.EL.stream(aqVar.f127365a).map(new C111390z(this, e, btVar, epVar, map)).collect(C58370cn.f155946a));
    }

    /* renamed from: g */
    public final C60870cx mo99112g(Map map, C113405ep epVar) {
        C121537f fVar = f309834b;
        C60870cx o = C60856cj.m92906o((C58485gu) Collection.EL.stream(m185101j()).map(new C111339ah(this, epVar, map)).collect(C58370cn.f155946a));
        C111380p pVar = C111380p.f309906a;
        C60870cx g = C60922j.m93044g(o, C47810es.m84963c(pVar), this.f309846o);
        fVar.mo105244m("fetchSuggestionsInternal", g);
        return g;
    }

    /* renamed from: gS */
    public final void mo17602gS(C91006f fVar) {
        if (this.f309837e.mo79746e(C90063do.f249395ci)) {
            fVar.mo85291r(getClass().getSimpleName());
            ((C110972aj) this.f309835c.mo27525b()).mo17602gS(fVar.mo85281e((Object) null));
        }
    }

    /* renamed from: h */
    public final C60870cx mo99113h(Map map) {
        C60870cx e = C60856cj.m92896e((C58485gu) Collection.EL.stream(m185101j()).flatMap(new C111337af(this, this.f309837e.mo79746e(C90063do.f249489eW), C113405ep.f314035q, map)).collect(C58370cn.f155946a));
        C111334ac acVar = C111334ac.f309811a;
        return C60922j.m93044g(e, C47810es.m84963c(acVar), this.f309846o);
    }
}
