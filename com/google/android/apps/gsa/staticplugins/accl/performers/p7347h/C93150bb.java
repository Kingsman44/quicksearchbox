package com.google.android.apps.gsa.staticplugins.accl.performers.p7347h;

import android.content.Context;
import android.graphics.Bitmap;
import android.media.MediaPlayer;
import android.net.Uri;
import android.text.TextUtils;
import com.evernote.android.state.BuildConfig;
import com.google.android.apps.gsa.search.core.p6491a.p6493b.C84352a;
import com.google.android.apps.gsa.search.core.p6517ak.p6518a.C84591r;
import com.google.android.apps.gsa.search.core.p6805i.C86124t;
import com.google.android.apps.gsa.search.core.service.C86610af;
import com.google.android.apps.gsa.search.core.service.C86775r;
import com.google.android.apps.gsa.search.shared.service.C87684al;
import com.google.android.apps.gsa.search.shared.service.p6935b.C88244um;
import com.google.android.apps.gsa.shared.notificationlistening.collection.p7121a.C90370d;
import com.google.android.apps.gsa.shared.notificationlistening.collection.p7121a.C90374h;
import com.google.android.apps.gsa.shared.notificationlistening.collection.p7121a.C90376j;
import com.google.android.apps.gsa.shared.notificationlistening.collection.p7121a.C90378l;
import com.google.android.apps.gsa.shared.notificationlistening.common.BundledMessageNotification;
import com.google.android.apps.gsa.shared.notificationlistening.common.MessageNotification;
import com.google.android.apps.gsa.shared.p7066m.C90014bt;
import com.google.android.apps.gsa.shared.util.p7159c.C90877ak;
import com.google.android.apps.gsa.staticplugins.accl.p7331c.p7332a.C92762n;
import com.google.android.apps.gsa.staticplugins.accl.p7337g.C92843f;
import com.google.android.apps.gsa.staticplugins.accl.p7338h.C92847b;
import com.google.android.googlequicksearchbox.R;
import com.google.android.libraries.gsa.conversation.clientop.C22428d;
import com.google.android.libraries.gsa.conversation.clientop.C22434e;
import com.google.android.libraries.gsa.conversation.clientop.C22534k;
import com.google.android.libraries.gsa.conversation.clientop.C22538o;
import com.google.android.libraries.gsa.conversation.clientop.p1841b.C22402a;
import com.google.android.libraries.gsa.p1876k.C22871g;
import com.google.android.libraries.search.p2871b.C37215b;
import com.google.android.libraries.search.p2871b.p2872a.p2874b.C37176a;
import com.google.assistant.p3897e.p3921j.C51807dw;
import com.google.assistant.p3897e.p3921j.C51809dy;
import com.google.assistant.p3897e.p3921j.C52070ec;
import com.google.assistant.p3897e.p3921j.C52235kf;
import com.google.assistant.p3897e.p3921j.acq;
import com.google.assistant.p3897e.p3921j.aez;
import com.google.common.base.C58837ba;
import com.google.common.p4522b.C58485gu;
import com.google.common.p4526f.C58976aa;
import com.google.common.p4526f.C59052c;
import com.google.common.p4526f.C59071e;
import com.google.common.p4526f.C59104x;
import com.google.common.p4526f.p4527a.C58975e;
import com.google.common.util.concurrent.C60826bg;
import com.google.common.util.concurrent.C60836bq;
import com.google.common.util.concurrent.C60838bs;
import com.google.common.util.concurrent.C60846c;
import com.google.common.util.concurrent.C60856cj;
import com.google.common.util.concurrent.C60870cx;
import com.google.common.util.concurrent.C60922j;
import com.google.common.util.concurrent.SettableFuture;
import com.google.net.p4726a.p4727a.C62722b;
import com.google.nlp.p4730a.p4731a.p4732a.p4733a.C62731b;
import com.google.nlp.p4730a.p4731a.p4732a.p4733a.C62734e;
import com.google.nlp.p4730a.p4731a.p4732a.p4733a.C62735f;
import com.google.nlp.p4730a.p4731a.p4732a.p4733a.C62736g;
import com.google.nlp.p4730a.p4734b.C62764a;
import com.google.nlp.p4730a.p4734b.C62765b;
import com.google.nlp.p4730a.p4734b.C62766c;
import com.google.nlp.p4730a.p4734b.C62767d;
import com.google.p4741o.p4742a.p4743a.C62852a;
import com.google.p4741o.p4742a.p4743a.C62853b;
import com.google.p4741o.p4742a.p4743a.C62856e;
import com.google.p4741o.p4742a.p4743a.C62857f;
import com.google.p4741o.p4742a.p4743a.C62862k;
import com.google.p4741o.p4742a.p4743a.C62863l;
import com.google.p4741o.p4742a.p4743a.C62864m;
import com.google.p4741o.p4742a.p4743a.C62865n;
import com.google.protobuf.C62940bt;
import com.google.protobuf.C62942bv;
import com.google.protobuf.C62971cq;
import com.google.protobuf.C63042fg;
import com.google.protobuf.C63062g;
import com.google.protobuf.C63070h;
import com.google.protobuf.C63088z;
import com.google.protobuf.p4750c.C62953e;
import com.google.speech.p5208h.p5210b.C66571a;
import com.google.speech.p5208h.p5210b.C66572b;
import com.google.speech.p5208h.p5210b.C66574d;
import com.google.speech.p5224k.p5225a.C67195am;
import com.google.speech.p5224k.p5225a.C67197ao;
import dagger.C68214a;
import java.io.ByteArrayOutputStream;
import java.util.concurrent.Executor;
import java.util.concurrent.TimeUnit;

/* renamed from: com.google.android.apps.gsa.staticplugins.accl.performers.h.bb */
/* compiled from: PG */
public final class C93150bb extends C22538o {

    /* renamed from: a */
    public static final C59071e f259800a = C59071e.m91332i("com.google.android.apps.gsa.staticplugins.accl.performers.h.bb");

    /* renamed from: b */
    public final C60836bq f259801b = new C60836bq();

    /* renamed from: c */
    public final C22871g f259802c;

    /* renamed from: d */
    public final C84352a f259803d;

    /* renamed from: e */
    public final C90374h f259804e;

    /* renamed from: f */
    public final C92843f f259805f;

    /* renamed from: g */
    public final C86124t f259806g;

    /* renamed from: h */
    public final C92762n f259807h;

    /* renamed from: i */
    public final C92847b f259808i;

    /* renamed from: j */
    public final Context f259809j;

    /* renamed from: k */
    public final Executor f259810k;

    /* renamed from: l */
    MediaPlayer f259811l;

    /* renamed from: m */
    public final C37215b f259812m;

    /* renamed from: o */
    private final C84591r f259813o;

    /* renamed from: p */
    private final C86610af f259814p;

    /* renamed from: q */
    private final C68214a f259815q;

    public C93150bb(C22871g gVar, C92762n nVar, C84352a aVar, C90374h hVar, C92843f fVar, C86124t tVar, C92847b bVar, C84591r rVar, C86610af afVar, Context context, C68214a aVar2, C22871g gVar2, C37215b bVar2) {
        this.f259802c = gVar;
        this.f259807h = nVar;
        this.f259803d = aVar;
        this.f259804e = hVar;
        this.f259805f = fVar;
        this.f259806g = tVar;
        this.f259808i = bVar;
        this.f259813o = rVar;
        this.f259814p = afVar;
        this.f259809j = context;
        this.f259815q = aVar2;
        this.f259812m = bVar2;
        this.f259810k = new C93125ad(gVar2);
    }

    /* renamed from: k */
    public static boolean m153214k(MessageNotification messageNotification) {
        String str = messageNotification.f252545v;
        return str != null && str.startsWith("audio");
    }

    /* renamed from: l */
    private final SettableFuture m153215l(String str, boolean z) {
        SettableFuture settableFuture = new SettableFuture();
        this.f259813o.mo78349a(str, new C93145ax(this), new C93146ay(this, settableFuture, z));
        C58976aa aaVar = C58975e.f156826a;
        return settableFuture;
    }

    /* renamed from: a */
    public final C60870cx mo20765a(C51809dy dyVar, C22434e eVar) {
        if (dyVar.f135936b.equals("notification.READ")) {
            C51807dw dwVar = dyVar.f135938d;
            if (dwVar == null) {
                dwVar = C51807dw.f135930b;
            }
            aez aez = (aez) m41992m(dwVar, "notification_read_args", aez.f134976g.getParserForType());
            if ((aez.f134978a & 1) != 0) {
                this.f259812m.mo19974a(C37176a.f96804B.mo40815i(C62722b.OK));
                int a = acq.m86281a(aez.f134983f);
                if (a != 0 && a == 3) {
                    C90374h hVar = this.f259804e;
                    int i = aez.f134979b;
                    C60870cx cxVar = hVar.f252406b;
                    cxVar.getClass();
                    return C60846c.m92878g(C60922j.m93045h(C60838bs.m92859i(C60922j.m93044g(cxVar, new C90370d(i), C60826bg.f164896a)), new C93140as(this, eVar), C60826bg.f164896a), Exception.class, new C93141at(this), C60826bg.f164896a);
                }
                return C60846c.m92878g(C60922j.m93045h(C60838bs.m92859i(this.f259804e.mo84076a(aez.f134979b)), new C93142au(this, aez), C60826bg.f164896a), Exception.class, new C93187z(this), C60826bg.f164896a);
            }
            this.f259812m.mo19974a(C37176a.f96804B.mo40815i(C62722b.INVALID_ARGUMENT));
            throw new C22534k();
        }
        this.f259812m.mo19974a(C37176a.f96804B.mo40815i(C62722b.INVALID_ARGUMENT));
        throw new C22428d(dyVar);
    }

    /* renamed from: b */
    public final C52070ec mo87551b(String str) {
        this.f259812m.mo19974a(C37176a.f97315ji.mo40805c(C62722b.INTERNAL));
        return C22402a.m41822b(C52235kf.INTERNAL, "Fails to play TTS for the message notification. ".concat(str));
    }

    /* renamed from: c */
    public final C60870cx mo87552c(Bitmap bitmap) {
        C60870cx cxVar;
        if (bitmap == null) {
            return C60856cj.m92900i(BuildConfig.FLAVOR);
        }
        C90378l lVar = (C90378l) this.f259815q.mo27525b();
        try {
            ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
            bitmap.compress(Bitmap.CompressFormat.JPEG, 100, byteArrayOutputStream);
            C63088z A = C63088z.m96139A(byteArrayOutputStream.toByteArray());
            C62864m mVar = (C62864m) C62865n.f169753b.createBuilder();
            mVar.copyOnWrite();
            ((C62865n) mVar.instance).f169755a = A;
            C62865n nVar = (C62865n) mVar.build();
            C62862k kVar = (C62862k) C62863l.f169749c.createBuilder();
            kVar.copyOnWrite();
            ((C62863l) kVar.instance).f169751a = 26;
            kVar.copyOnWrite();
            ((C62863l) kVar.instance).f169752b = 1;
            C62863l lVar2 = (C62863l) kVar.build();
            C62852a aVar = (C62852a) C62853b.f169733c.createBuilder();
            aVar.copyOnWrite();
            C62853b bVar = (C62853b) aVar.instance;
            lVar2.getClass();
            C62971cq cqVar = bVar.f169736b;
            if (!cqVar.mo58948c()) {
                bVar.f169736b = C62942bv.mutableCopy(cqVar);
            }
            bVar.f169736b.add(lVar2);
            aVar.copyOnWrite();
            nVar.getClass();
            ((C62853b) aVar.instance).f169735a = nVar;
            C62853b bVar2 = (C62853b) aVar.build();
            C62856e eVar = (C62856e) C62857f.f169740b.createBuilder();
            eVar.copyOnWrite();
            C62857f fVar = (C62857f) eVar.instance;
            bVar2.getClass();
            C62971cq cqVar2 = fVar.f169742a;
            if (!cqVar2.mo58948c()) {
                fVar.f169742a = C62942bv.mutableCopy(cqVar2);
            }
            fVar.f169742a.add(bVar2);
            C62857f fVar2 = (C62857f) eVar.build();
            if (fVar2 == null) {
                cxVar = C60856cj.m92900i(BuildConfig.FLAVOR);
            } else {
                cxVar = C90877ak.m148471e(lVar.f252416c.mo28202b("Get image annotations", new C90376j(lVar, fVar2)), 2, TimeUnit.SECONDS, lVar.f252415b);
            }
        } catch (Exception e) {
            ((C59052c) ((C59052c) ((C59052c) C90378l.f252414a.mo56225c()).mo56382g(e)).mo56372aa(10860)).mo56386p("Couldn't get image annotation");
            cxVar = C60856cj.m92900i(BuildConfig.FLAVOR);
        }
        return C60846c.m92879h(cxVar, Exception.class, C93127af.f259762a, C60826bg.f164896a);
    }

    /* renamed from: d */
    public final C60870cx mo87553d(MessageNotification messageNotification) {
        return C60922j.m93045h(mo87552c(messageNotification.f252533C), new C93122aa(this, messageNotification), C60826bg.f164896a);
    }

    /* renamed from: e */
    public final SettableFuture mo87554e(BundledMessageNotification bundledMessageNotification, boolean z) {
        if (TextUtils.isEmpty(bundledMessageNotification.mo84115e())) {
            return m153215l(bundledMessageNotification.mo84118h(), z);
        }
        StringBuilder sb = new StringBuilder();
        C58485gu d = bundledMessageNotification.mo84113d();
        int size = d.size();
        for (int i = 0; i < size; i++) {
            MessageNotification messageNotification = (MessageNotification) d.get(i);
            sb.append(String.format(this.f259809j.getString(R.string.sender_message_format_for_group_messages_auto), new Object[]{messageNotification.f252535E, messageNotification.f252543t}));
            sb.append(". ");
        }
        return m153215l(sb.toString(), z);
    }

    /* renamed from: f */
    public final SettableFuture mo87555f(String str) {
        SettableFuture settableFuture = new SettableFuture();
        this.f259813o.mo78349a(str, new C93147az(this), new C93149ba(this, settableFuture));
        return settableFuture;
    }

    /* renamed from: g */
    public final C66572b mo87556g(C62731b bVar) {
        C66571a aVar = (C66571a) C66572b.f181083d.createBuilder();
        C62766c cVar = (C62766c) C62767d.f169504c.createBuilder();
        C62764a aVar2 = (C62764a) C62765b.f169498d.createBuilder();
        aVar2.copyOnWrite();
        C62765b bVar2 = (C62765b) aVar2.instance;
        bVar2.f169500a |= 2;
        bVar2.f169502c = "messaging_v2";
        C63062g gVar = (C63062g) C63070h.f170215c.createBuilder();
        gVar.copyOnWrite();
        ((C63070h) gVar.instance).f170217a = "type.googleapis.com/nlp_generation.clients.messaging_v2.MessageCluster";
        C63088z byteString = ((C62734e) bVar.build()).toByteString();
        gVar.copyOnWrite();
        byteString.getClass();
        ((C63070h) gVar.instance).f170218b = byteString;
        aVar2.copyOnWrite();
        C62765b bVar3 = (C62765b) aVar2.instance;
        C63070h hVar = (C63070h) gVar.build();
        hVar.getClass();
        bVar3.f169501b = hVar;
        bVar3.f169500a |= 1;
        cVar.copyOnWrite();
        C62767d dVar = (C62767d) cVar.instance;
        C62765b bVar4 = (C62765b) aVar2.build();
        bVar4.getClass();
        dVar.f169507b = bVar4;
        dVar.f169506a = 1;
        aVar.mo59680a(cVar);
        C62940bt btVar = C66574d.f181091b;
        C67195am amVar = (C67195am) C67197ao.f182649b.createBuilder();
        amVar.mo59777a();
        aVar.mo58885m(btVar, (C67197ao) amVar.build());
        if (this.f259806g.mo79746e(C90014bt.f247506iT)) {
            aVar.copyOnWrite();
            C66572b bVar5 = (C66572b) aVar.instance;
            bVar5.f181086a |= 1;
            bVar5.f181087b = "en-US";
        }
        return (C66572b) aVar.build();
    }

    /* renamed from: h */
    public final CharSequence mo87557h(MessageNotification messageNotification) {
        CharSequence charSequence = messageNotification.f252543t;
        if (charSequence == null) {
            charSequence = BuildConfig.FLAVOR;
        }
        if (TextUtils.isEmpty(messageNotification.f252541r)) {
            return charSequence;
        }
        return String.format(this.f259809j.getString(R.string.sender_message_format_for_group_messages_auto), new Object[]{messageNotification.f252535E, messageNotification.f252543t});
    }

    /* renamed from: i */
    public final void mo87558i(C62731b bVar, MessageNotification messageNotification, String str) {
        C63088z zVar;
        Uri uri;
        CharSequence charSequence = messageNotification.f252543t;
        if (!this.f259806g.mo79746e(C90014bt.f247528ip) || str.length() == 0) {
            str = null;
        }
        C62735f fVar = (C62735f) C62736g.f169448h.createBuilder();
        String g = C58837ba.m90858g(messageNotification.f252545v);
        fVar.copyOnWrite();
        C62736g gVar = (C62736g) fVar.instance;
        gVar.f169450a |= 4;
        gVar.f169453d = g;
        C63088z E = charSequence == null ? C63088z.f170246b : C63088z.m96143E(charSequence.toString());
        fVar.copyOnWrite();
        C62736g gVar2 = (C62736g) fVar.instance;
        E.getClass();
        gVar2.f169450a |= 16;
        gVar2.f169455f = E;
        String obj = messageNotification.f252535E.toString();
        fVar.copyOnWrite();
        C62736g gVar3 = (C62736g) fVar.instance;
        obj.getClass();
        gVar3.f169450a |= 2;
        gVar3.f169452c = obj;
        C63042fg i = C62953e.m95484i(messageNotification.f252592m);
        fVar.copyOnWrite();
        C62736g gVar4 = (C62736g) fVar.instance;
        i.getClass();
        gVar4.f169451b = i;
        gVar4.f169450a |= 1;
        if (str == null) {
            zVar = C63088z.f170246b;
        } else {
            zVar = C63088z.m96143E(str.toString());
        }
        fVar.copyOnWrite();
        C62736g gVar5 = (C62736g) fVar.instance;
        zVar.getClass();
        gVar5.f169450a |= 32;
        gVar5.f169456g = zVar;
        String str2 = messageNotification.f252545v;
        if (!(str2 == null || ((!str2.equals("broadcast/assistant_server_audio") && !str2.equals("family_broadcast/assistant_server_audio")) || (uri = messageNotification.f252546w) == null || uri.toString() == null))) {
            String uri2 = messageNotification.f252546w.toString();
            fVar.copyOnWrite();
            C62736g gVar6 = (C62736g) fVar.instance;
            uri2.getClass();
            gVar6.f169450a |= 8;
            gVar6.f169454e = uri2;
        }
        C62736g gVar7 = (C62736g) fVar.build();
        bVar.copyOnWrite();
        C62734e eVar = (C62734e) bVar.instance;
        C62734e eVar2 = C62734e.f169440g;
        gVar7.getClass();
        eVar.mo58630a();
        eVar.f169445d.add(gVar7);
    }

    /* renamed from: j */
    public final void mo87559j(C88244um umVar) {
        C58976aa aaVar = C58975e.f156826a;
        C86775r rVar = this.f259814p.f233977l;
        if (rVar == null) {
            C59104x d = f259800a.mo56226d();
            d.mo56378ag(C58975e.f156826a, "NotifReadPerformer");
            ((C59052c) ((C59052c) d).mo56372aa(13420)).mo56386p("notifyAttachedClient - no attached client.");
            return;
        }
        rVar.f234383e.mo80379b(new C87684al(umVar).mo81964a());
    }
}
